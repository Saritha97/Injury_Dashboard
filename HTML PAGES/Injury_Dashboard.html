<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Karanvir Virdi Saritha Kumari Krishna Reddy Stephanie Ajah">
<meta name="dcterms.date" content="2024-12-12">

<title>DATA*6200 Final Project: Severe Injuries and Occupational Illness Tracking Dashboard for understanding Injury Trends</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Final_Project_6200_files/libs/clipboard/clipboard.min.js"></script>
<script src="Final_Project_6200_files/libs/quarto-html/quarto.js"></script>
<script src="Final_Project_6200_files/libs/quarto-html/popper.min.js"></script>
<script src="Final_Project_6200_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Final_Project_6200_files/libs/quarto-html/anchor.min.js"></script>
<link href="Final_Project_6200_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Final_Project_6200_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Final_Project_6200_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Final_Project_6200_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Final_Project_6200_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">DATA*6200 Final Project: Severe Injuries and Occupational Illness Tracking Dashboard for understanding Injury Trends</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Karanvir Virdi Saritha Kumari Krishna Reddy Stephanie Ajah </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 12, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The “Severe Injuries and Occupational Illness Tracking Dashboard” is an interactive tool designed to provide insights into injury and illness trends across various industries and states in The United States of America. The dashboard allows users to explore data on severe injuries, including amputations, hospitalizations, and specific occupational illnesses such as respiratory conditions and skin disorders. By visualizing trends over time and filtering by key factors such as year, industry, and state, the dashboard enables stakeholders to identify patterns, assess risks, and develop strategies to improve workplace safety. This project aims to enhance understanding and decision-making related to health and safety.</p>
<section id="step-1---load-required-libraries-and-csv-files" class="level2">
<h2 class="anchored" data-anchor-id="step-1---load-required-libraries-and-csv-files">Step 1 - Load required libraries and csv files</h2>
<ul>
<li>‘shiny’ is used to build interactive web applications.</li>
<li>‘shinyjs’ adds JavaScript functionalities to enhance Shiny apps.</li>
<li>‘shinydashboard’ provides a framework for creating visually structured dashboards in Shiny.</li>
<li>‘plotly’ is used for creating interactive, web-based visualizations.</li>
<li>‘ggplot2’ produces static, elegant, and layered data visualizations.</li>
<li>‘dplyr’ is used for data manipulation, including functions for filtering, selecting, grouping, and summarizing data.</li>
<li>‘maps’ provides geographical maps and spatial data for visualizations.</li>
<li>‘tidyr’ simplifies data cleaning and reshaping for tidy data structures.</li>
<li>‘DT’ is used to display interactive, responsive, and customizable data tables.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the following commands to install the required packages, if you do not have the packages installed</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("shiny")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("shinyjs")</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("shinydashboard")</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("plotly")</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("ggplot2")</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("dplyr")</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("maps")</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("tidyr")</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("DT")</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shinyjs)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shinydashboard)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maps)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To read both csv file using function read.csv passing the file path as the required parameter.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"/Users/sarithakumarik/Documents/DATA6200/FinalProject/Dataset"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>severe_injuries_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"critical_injuries_data.csv"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>occ_injuries_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"occupational_illness_data.csv"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-2-design-of-the-shiny-ui-dashboard" class="level2">
<h2 class="anchored" data-anchor-id="step-2-design-of-the-shiny-ui-dashboard">Step 2: Design of the Shiny UI Dashboard</h2>
<p>The below Shiny UI code defines an interactive dashboard to analyze injury data with a visually appealing and user-friendly interface.</p>
<p>The following are the key pages and features in the UI of the Shiny app:</p>
<ul>
<li>Welcome Page:
<ul>
<li>Features a title, brief description, and a “Get Started” button for navigation.</li>
</ul></li>
<li>Dashboard Page:
<ul>
<li>Main navigation hub with buttons for exploring severe injuries and occupational illnesses.</li>
</ul></li>
<li>Severe Injuries Page:
<ul>
<li>Includes tabs like “Injuries by State,” “Top Industries,” and “Body Part Analysis.”</li>
<li>Provides interactive filters and visualizations for detailed insights.</li>
</ul></li>
<li>Occupational Illness Page:
<ul>
<li>Similar layout to the Severe Injuries Page with illness-specific analysis tabs.</li>
<li>Offers charts, tables, and filters for customized exploration.</li>
</ul></li>
<li>Accessibility Features:
<ul>
<li>Back buttons, download options and detailed tables, ensuring a comprehensive exploration of injury and illness data.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">useShinyjs</span>(),</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Welcome Page</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">div</span>(</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="st">"welcome-page"</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">style =</span> <span class="st">"display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background-color: #4682b4;"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  tags<span class="sc">$</span><span class="fu">h1</span>(</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"font-family: 'Playfair Display', serif; font-size: 6rem; font-weight: 700; color: #ffffff; margin-bottom: 2rem;"</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Welcome to Injury Data Dashboard!"</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  tags<span class="sc">$</span><span class="fu">p</span>(</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"font-family: 'Playfair Display', serif; font-size: 2.5rem; color: #333; margin-bottom: 2rem;"</span>,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Let's do some analysis."</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">actionButton</span>(</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">inputId =</span> <span class="st">"get_started_btn"</span>,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Get Started"</span>,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">class =</span> <span class="st">"btn btn-primary btn-lg"</span>,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"font-family: 'Playfair Display', serif; font-size: 3rem; font-weight: 600; padding: 1rem 2rem; background-color: #303030; color: #ffffff;"</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Dashboard Page</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="fu">hidden</span>(</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">div</span>(</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="st">"dashboard-page"</span>,</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background-color: #4682b4;"</span>,</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    tags<span class="sc">$</span><span class="fu">h1</span>(</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="st">"font-family: 'Playfair Display', serif; font-size: 6rem; font-weight: 700; color: #ffffff; margin-bottom: 8rem;"</span>,</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Injury Data Dashboard"</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fluidRow</span>(</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">actionButton</span>(</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">inputId =</span> <span class="st">"severe_btn"</span>,</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"Severe Injuries"</span>,</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">class =</span> <span class="st">"btn btn-primary btn-lg"</span>,</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">style =</span> <span class="st">"font-family: 'Playfair Display', serif; font-size: 2.5rem; font-weight: 600; padding: 1rem 2rem; margin-right: 1rem; background-color: #303030; color: #ffffff;"</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>      <span class="fu">actionButton</span>(</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">inputId =</span> <span class="st">"occupational_btn"</span>,</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"Occupational Injuries/Illnesses"</span>,</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">class =</span> <span class="st">"btn btn-primary btn-lg"</span>,</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">style =</span> <span class="st">"font-family: 'Playfair Display', serif; font-size: 2.5rem; font-weight: 600; padding: 1rem 2rem; background-color: #303030; color: #ffffff;"</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Severe Injuries Page</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="fu">hidden</span>(</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">div</span>(</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="st">"severe-page"</span>,</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dashboardPage</span>(</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dashboardHeader</span>(</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">div</span>(</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>          <span class="fu">actionButton</span>(</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>            <span class="at">inputId =</span> <span class="st">"back_button"</span>,</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="cn">NULL</span>,</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>            <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"arrow-left"</span>),</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>            <span class="at">style =</span> <span class="st">"margin-right: 0px; border: none; background-color: transparent; color: white;"</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>          <span class="fu">span</span>(<span class="st">"Severe Injuries"</span>, <span class="at">style =</span> <span class="st">"font-size: 19px; padding-left: 0px;"</span>)</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dashboardSidebar</span>(</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sidebarMenu</span>(</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>          <span class="fu">menuItem</span>(<span class="st">"Injuries by State"</span>, <span class="at">tabName =</span> <span class="st">"state"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"map-marker-alt"</span>)),</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>          <span class="fu">menuItem</span>(<span class="st">"Top Industries"</span>, <span class="at">tabName =</span> <span class="st">"industries"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"building"</span>)),</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>          <span class="fu">menuItem</span>(<span class="st">"Top States"</span>, <span class="at">tabName =</span> <span class="st">"states"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"flag-checkered"</span>)),</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>          <span class="fu">menuItem</span>(<span class="st">"Event Categories"</span>, <span class="at">tabName =</span> <span class="st">"events"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"calendar-alt"</span>)),</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>          <span class="fu">menuItem</span>(<span class="st">"Source Categories"</span>, <span class="at">tabName =</span> <span class="st">"source"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"bullseye"</span>)),</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>          <span class="fu">menuItem</span>(<span class="st">"Body Part Analysis"</span>, <span class="at">tabName =</span> <span class="st">"bodypart"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"stethoscope"</span>)),</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>          <span class="fu">menuItem</span>(<span class="st">"Trend Overview"</span>, <span class="at">tabName =</span> <span class="st">"trend"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"chart-line"</span>)),</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>          <span class="fu">menuItem</span>(<span class="st">"Interactive Filters"</span>, <span class="at">tabName =</span> <span class="st">"filtering"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"filter"</span>))</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dashboardBody</span>(</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tabItems</span>(</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Injuries by State Tab</span></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tabItem</span>(<span class="at">tabName =</span> <span class="st">"state"</span>,</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">h2</span>(<span class="st">"Injuries by State Analysis"</span>,</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>                     <span class="at">style =</span> <span class="st">"font-weight: bold; font-size: 3.5rem; text-align: center;"</span>),</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">sliderInput</span>(</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"year"</span>,</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Select Year:"</span>,</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>                    <span class="at">min =</span> <span class="dv">2015</span>,</span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>                    <span class="at">max =</span> <span class="dv">2024</span>,</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>                    <span class="at">value =</span> <span class="dv">2024</span>,</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>                    <span class="at">step =</span> <span class="dv">1</span>,</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>                    <span class="at">animate =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>                  ),</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">plotlyOutput</span>(<span class="st">"state_plot"</span>),</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">plotOutput</span>(<span class="st">"hospitalization_amputation_plot"</span>)</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Top Industries Tab</span></span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tabItem</span>(<span class="at">tabName =</span> <span class="st">"industries"</span>,</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">h2</span>(<span class="st">"Top Industries Analysis"</span>,</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>                     <span class="at">style =</span> <span class="st">"font-weight: bold; font-size: 3.5rem; text-align: center;"</span>),</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">sliderInput</span>(</span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"year_industry"</span>,</span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Select Year:"</span>,</span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>                    <span class="at">min =</span> <span class="dv">2015</span>,</span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>                    <span class="at">max =</span> <span class="dv">2024</span>,</span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>                    <span class="at">value =</span> <span class="dv">2024</span>,</span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>                    <span class="at">step =</span> <span class="dv">1</span>,</span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>                    <span class="at">animate =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>                  ),</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">fluidRow</span>(</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">column</span>(<span class="dv">12</span>, <span class="at">style =</span> <span class="st">"margin-top: 20px;"</span>, </span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">downloadButton</span>(<span class="st">"download_industry_plot"</span>, <span class="st">"Download Filtered Data"</span>, </span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">style =</span> <span class="st">"float: right;"</span>))</span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>                  ),</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">plotOutput</span>(<span class="st">"industry_pie_chart"</span>),</span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">h4</span>(<span class="st">"Complete List of all Industries"</span>, <span class="at">style =</span> <span class="st">"margin-top: 20px; font-weight: bold; text-align: left;"</span>),</span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">tableOutput</span>(<span class="st">"industry_table"</span>)</span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Top States Tab</span></span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tabItem</span>(</span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>            <span class="at">tabName =</span> <span class="st">"states"</span>,</span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>            <span class="fu">h2</span>(<span class="st">"Top States Analysis"</span>,</span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>               <span class="at">style =</span> <span class="st">"font-weight: bold; font-size: 3.5rem; text-align: center;"</span>),</span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sliderInput</span>(</span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>              <span class="st">"year_state"</span>,</span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Select Year:"</span>,</span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>              <span class="at">min =</span> <span class="dv">2015</span>,</span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>              <span class="at">max =</span> <span class="dv">2024</span>,</span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>              <span class="at">value =</span> <span class="dv">2024</span>,</span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>              <span class="at">step =</span> <span class="dv">1</span>,</span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a>              <span class="at">animate =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>              <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>            <span class="fu">fluidRow</span>(</span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(<span class="dv">12</span>, <span class="at">style =</span> <span class="st">"margin-top: 20px;"</span>, </span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">downloadButton</span>(<span class="st">"download_top_states_plot"</span>, <span class="st">"Download Filtered Data"</span>, </span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">style =</span> <span class="st">"float: right;"</span>))</span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a>            <span class="fu">plotOutput</span>(<span class="st">"top_states_plot"</span>),</span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>            <span class="fu">plotOutput</span>(<span class="st">"top_states_amputation_hospitalization"</span>),</span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>            <span class="fu">h4</span>(<span class="st">"Complete List of States"</span>, <span class="at">style =</span> <span class="st">"margin-top: 20px; font-weight: bold; text-align: left;"</span>),</span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>            <span class="fu">tableOutput</span>(<span class="st">"state_table"</span>)</span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Event Categories Tab</span></span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tabItem</span>(</span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>            <span class="at">tabName =</span> <span class="st">"events"</span>,</span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>            <span class="fu">h2</span>(<span class="st">"Event Categories Analysis"</span>,</span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>               <span class="at">style =</span> <span class="st">"font-weight: bold; font-size: 3.5rem; text-align: center;"</span>),</span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sliderInput</span>(</span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>              <span class="st">"year_event"</span>,</span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Select Year:"</span>,</span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>              <span class="at">min =</span> <span class="dv">2015</span>,</span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>              <span class="at">max =</span> <span class="dv">2024</span>,</span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>              <span class="at">value =</span> <span class="dv">2024</span>,</span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>              <span class="at">step =</span> <span class="dv">1</span>,</span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>              <span class="at">animate =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>              <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>            <span class="fu">selectInput</span>(</span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>              <span class="st">"industry_event"</span>,</span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Select Industry:"</span>,</span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a>              <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"All Industries"</span>, <span class="fu">unique</span>(severe_injuries_data<span class="sc">$</span>industry)),</span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a>              <span class="at">selected =</span> <span class="st">"All Industries"</span></span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>            <span class="fu">fluidRow</span>(</span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(<span class="dv">12</span>, <span class="at">style =</span> <span class="st">"margin-top: 20px;"</span>, </span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">downloadButton</span>(<span class="st">"download_event_category_plot"</span>, <span class="st">"Download Filtered Data"</span>, </span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">style =</span> <span class="st">"float: right;"</span>))</span>
<span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a>            <span class="fu">plotOutput</span>(<span class="st">"event_category_pie_chart"</span>),</span>
<span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a>            <span class="fu">h4</span>(<span class="st">"Complete List of Events leading to Injuries"</span>, <span class="at">style =</span> <span class="st">"margin-top: 20px; font-weight: bold; text-align: left;"</span>),</span>
<span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a>            <span class="fu">tableOutput</span>(<span class="st">"event_category_table"</span>)</span>
<span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-178"><a href="#cb3-178" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Source Analysis Tab</span></span>
<span id="cb3-179"><a href="#cb3-179" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tabItem</span>(</span>
<span id="cb3-180"><a href="#cb3-180" aria-hidden="true" tabindex="-1"></a>            <span class="at">tabName =</span> <span class="st">"source"</span>,</span>
<span id="cb3-181"><a href="#cb3-181" aria-hidden="true" tabindex="-1"></a>            <span class="fu">h2</span>(<span class="st">"Source Categories Analysis"</span>,</span>
<span id="cb3-182"><a href="#cb3-182" aria-hidden="true" tabindex="-1"></a>               <span class="at">style =</span> <span class="st">"font-weight: bold; font-size: 3.5rem; text-align: center;"</span>),</span>
<span id="cb3-183"><a href="#cb3-183" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sliderInput</span>(</span>
<span id="cb3-184"><a href="#cb3-184" aria-hidden="true" tabindex="-1"></a>              <span class="st">"year_source"</span>,</span>
<span id="cb3-185"><a href="#cb3-185" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Select Year:"</span>,</span>
<span id="cb3-186"><a href="#cb3-186" aria-hidden="true" tabindex="-1"></a>              <span class="at">min =</span> <span class="dv">2015</span>,</span>
<span id="cb3-187"><a href="#cb3-187" aria-hidden="true" tabindex="-1"></a>              <span class="at">max =</span> <span class="dv">2024</span>,</span>
<span id="cb3-188"><a href="#cb3-188" aria-hidden="true" tabindex="-1"></a>              <span class="at">value =</span> <span class="dv">2024</span>,</span>
<span id="cb3-189"><a href="#cb3-189" aria-hidden="true" tabindex="-1"></a>              <span class="at">step =</span> <span class="dv">1</span>,</span>
<span id="cb3-190"><a href="#cb3-190" aria-hidden="true" tabindex="-1"></a>              <span class="at">animate =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-191"><a href="#cb3-191" aria-hidden="true" tabindex="-1"></a>              <span class="at">sep =</span> <span class="st">""</span> </span>
<span id="cb3-192"><a href="#cb3-192" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-193"><a href="#cb3-193" aria-hidden="true" tabindex="-1"></a>            <span class="fu">selectInput</span>(</span>
<span id="cb3-194"><a href="#cb3-194" aria-hidden="true" tabindex="-1"></a>              <span class="st">"industry_source"</span>,</span>
<span id="cb3-195"><a href="#cb3-195" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Select Industry:"</span>,</span>
<span id="cb3-196"><a href="#cb3-196" aria-hidden="true" tabindex="-1"></a>              <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"All Industries"</span>, <span class="fu">unique</span>(severe_injuries_data<span class="sc">$</span>industry)),</span>
<span id="cb3-197"><a href="#cb3-197" aria-hidden="true" tabindex="-1"></a>              <span class="at">selected =</span> <span class="st">"All Industries"</span></span>
<span id="cb3-198"><a href="#cb3-198" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-199"><a href="#cb3-199" aria-hidden="true" tabindex="-1"></a>            <span class="fu">fluidRow</span>(</span>
<span id="cb3-200"><a href="#cb3-200" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(<span class="dv">12</span>, <span class="at">style =</span> <span class="st">"margin-top: 20px;"</span>, </span>
<span id="cb3-201"><a href="#cb3-201" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">downloadButton</span>(<span class="st">"download_source_category_plot"</span>, <span class="st">"Download Filtered Data"</span>, </span>
<span id="cb3-202"><a href="#cb3-202" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">style =</span> <span class="st">"float: right;"</span>))</span>
<span id="cb3-203"><a href="#cb3-203" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-204"><a href="#cb3-204" aria-hidden="true" tabindex="-1"></a>            <span class="fu">plotOutput</span>(<span class="st">"source_category_pie_chart"</span>),</span>
<span id="cb3-205"><a href="#cb3-205" aria-hidden="true" tabindex="-1"></a>            <span class="fu">h4</span>(<span class="st">"Complete List of all Injury Sources"</span>, <span class="at">style =</span> <span class="st">"margin-top: 20px; font-weight: bold; text-align: left;"</span>),</span>
<span id="cb3-206"><a href="#cb3-206" aria-hidden="true" tabindex="-1"></a>            <span class="fu">tableOutput</span>(<span class="st">"source_category_table"</span>)</span>
<span id="cb3-207"><a href="#cb3-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-208"><a href="#cb3-208" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb3-209"><a href="#cb3-209" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Body Part Analysis Tab</span></span>
<span id="cb3-210"><a href="#cb3-210" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tabItem</span>(<span class="at">tabName =</span> <span class="st">"bodypart"</span>,</span>
<span id="cb3-211"><a href="#cb3-211" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">h2</span>(<span class="st">"Body Part Analysis"</span>,</span>
<span id="cb3-212"><a href="#cb3-212" aria-hidden="true" tabindex="-1"></a>                     <span class="at">style =</span> <span class="st">"font-weight: bold; font-size: 3.5rem; text-align: center;"</span>),</span>
<span id="cb3-213"><a href="#cb3-213" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">sliderInput</span>(</span>
<span id="cb3-214"><a href="#cb3-214" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"year_body_part"</span>,</span>
<span id="cb3-215"><a href="#cb3-215" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Select Year:"</span>,</span>
<span id="cb3-216"><a href="#cb3-216" aria-hidden="true" tabindex="-1"></a>                    <span class="at">min =</span> <span class="dv">2015</span>,</span>
<span id="cb3-217"><a href="#cb3-217" aria-hidden="true" tabindex="-1"></a>                    <span class="at">max =</span> <span class="dv">2024</span>,</span>
<span id="cb3-218"><a href="#cb3-218" aria-hidden="true" tabindex="-1"></a>                    <span class="at">value =</span> <span class="dv">2024</span>,</span>
<span id="cb3-219"><a href="#cb3-219" aria-hidden="true" tabindex="-1"></a>                    <span class="at">step =</span> <span class="dv">1</span>,</span>
<span id="cb3-220"><a href="#cb3-220" aria-hidden="true" tabindex="-1"></a>                    <span class="at">animate =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-221"><a href="#cb3-221" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb3-222"><a href="#cb3-222" aria-hidden="true" tabindex="-1"></a>                  ),</span>
<span id="cb3-223"><a href="#cb3-223" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">selectInput</span>(</span>
<span id="cb3-224"><a href="#cb3-224" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"industry_body_part"</span>,</span>
<span id="cb3-225"><a href="#cb3-225" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Select Industry:"</span>,</span>
<span id="cb3-226"><a href="#cb3-226" aria-hidden="true" tabindex="-1"></a>                    <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"All Industries"</span>, <span class="fu">unique</span>(severe_injuries_data<span class="sc">$</span>industry)),</span>
<span id="cb3-227"><a href="#cb3-227" aria-hidden="true" tabindex="-1"></a>                    <span class="at">selected =</span> <span class="st">"All Industries"</span></span>
<span id="cb3-228"><a href="#cb3-228" aria-hidden="true" tabindex="-1"></a>                  ),</span>
<span id="cb3-229"><a href="#cb3-229" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">fluidRow</span>(</span>
<span id="cb3-230"><a href="#cb3-230" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">column</span>(<span class="dv">12</span>, <span class="at">style =</span> <span class="st">"margin-top: 20px;"</span>, </span>
<span id="cb3-231"><a href="#cb3-231" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">downloadButton</span>(<span class="st">"download_body_part_plot"</span>, <span class="st">"Download Filtered Data"</span>, </span>
<span id="cb3-232"><a href="#cb3-232" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">style =</span> <span class="st">"float: right;"</span>))</span>
<span id="cb3-233"><a href="#cb3-233" aria-hidden="true" tabindex="-1"></a>                  ),</span>
<span id="cb3-234"><a href="#cb3-234" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">plotOutput</span>(<span class="st">"body_part_pie_chart"</span>),</span>
<span id="cb3-235"><a href="#cb3-235" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">h4</span>(<span class="st">"Complete List of all Body Parts Injured"</span>, <span class="at">style =</span> <span class="st">"margin-top: 20px; font-weight: bold; text-align: left;"</span>),</span>
<span id="cb3-236"><a href="#cb3-236" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">tableOutput</span>(<span class="st">"body_part_table"</span>)</span>
<span id="cb3-237"><a href="#cb3-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-238"><a href="#cb3-238" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb3-239"><a href="#cb3-239" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Trend Overview Tab</span></span>
<span id="cb3-240"><a href="#cb3-240" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tabItem</span>(</span>
<span id="cb3-241"><a href="#cb3-241" aria-hidden="true" tabindex="-1"></a>            <span class="at">tabName =</span> <span class="st">"trend"</span>,</span>
<span id="cb3-242"><a href="#cb3-242" aria-hidden="true" tabindex="-1"></a>            <span class="fu">h2</span>(<span class="st">"Trend Overview"</span>,</span>
<span id="cb3-243"><a href="#cb3-243" aria-hidden="true" tabindex="-1"></a>               <span class="at">style =</span> <span class="st">"font-weight: bold; font-size: 3.5rem; text-align: center;"</span>),</span>
<span id="cb3-244"><a href="#cb3-244" aria-hidden="true" tabindex="-1"></a>            <span class="fu">selectInput</span>(</span>
<span id="cb3-245"><a href="#cb3-245" aria-hidden="true" tabindex="-1"></a>              <span class="st">"industry_trend"</span>,</span>
<span id="cb3-246"><a href="#cb3-246" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Select Industry:"</span>,</span>
<span id="cb3-247"><a href="#cb3-247" aria-hidden="true" tabindex="-1"></a>              <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"All Industries"</span>, <span class="fu">unique</span>(severe_injuries_data<span class="sc">$</span>industry)),</span>
<span id="cb3-248"><a href="#cb3-248" aria-hidden="true" tabindex="-1"></a>              <span class="at">selected =</span> <span class="st">"All Industries"</span></span>
<span id="cb3-249"><a href="#cb3-249" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-250"><a href="#cb3-250" aria-hidden="true" tabindex="-1"></a>            <span class="fu">fluidRow</span>(</span>
<span id="cb3-251"><a href="#cb3-251" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(<span class="dv">12</span>, <span class="at">style =</span> <span class="st">"margin-top: 20px;"</span>, </span>
<span id="cb3-252"><a href="#cb3-252" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">downloadButton</span>(<span class="st">"download_trend_plot"</span>, <span class="st">"Download Filtered Data"</span>, </span>
<span id="cb3-253"><a href="#cb3-253" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">style =</span> <span class="st">"float: right;"</span>))</span>
<span id="cb3-254"><a href="#cb3-254" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-255"><a href="#cb3-255" aria-hidden="true" tabindex="-1"></a>            <span class="fu">plotlyOutput</span>(<span class="st">"line_plot"</span>)</span>
<span id="cb3-256"><a href="#cb3-256" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb3-257"><a href="#cb3-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-258"><a href="#cb3-258" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Interactive Filter Tab</span></span>
<span id="cb3-259"><a href="#cb3-259" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tabItem</span>(</span>
<span id="cb3-260"><a href="#cb3-260" aria-hidden="true" tabindex="-1"></a>            <span class="at">tabName =</span> <span class="st">"filtering"</span>,</span>
<span id="cb3-261"><a href="#cb3-261" aria-hidden="true" tabindex="-1"></a>            <span class="fu">h2</span>(<span class="st">"Interactive Filters for Severe Injuries"</span>,</span>
<span id="cb3-262"><a href="#cb3-262" aria-hidden="true" tabindex="-1"></a>               <span class="at">style =</span> <span class="st">"font-weight: bold; font-size: 3.5rem; text-align: center;"</span>),</span>
<span id="cb3-263"><a href="#cb3-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-264"><a href="#cb3-264" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Filters</span></span>
<span id="cb3-265"><a href="#cb3-265" aria-hidden="true" tabindex="-1"></a>            <span class="fu">fluidRow</span>(</span>
<span id="cb3-266"><a href="#cb3-266" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(<span class="dv">4</span>, <span class="fu">sliderInput</span>(<span class="st">"year_filter"</span>, <span class="st">"Select Year:"</span>, </span>
<span id="cb3-267"><a href="#cb3-267" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">min =</span> <span class="dv">2015</span>,</span>
<span id="cb3-268"><a href="#cb3-268" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">max =</span> <span class="dv">2024</span>,</span>
<span id="cb3-269"><a href="#cb3-269" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">value =</span> <span class="dv">2024</span>,</span>
<span id="cb3-270"><a href="#cb3-270" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">step =</span> <span class="dv">1</span>,</span>
<span id="cb3-271"><a href="#cb3-271" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">animate =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-272"><a href="#cb3-272" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">sep =</span> <span class="st">""</span>)),</span>
<span id="cb3-273"><a href="#cb3-273" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(<span class="dv">4</span>, <span class="fu">selectInput</span>(<span class="st">"state_filter"</span>, <span class="st">"Select State:"</span>, </span>
<span id="cb3-274"><a href="#cb3-274" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"All States"</span>, <span class="fu">unique</span>(severe_injuries_data<span class="sc">$</span>state)), </span>
<span id="cb3-275"><a href="#cb3-275" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">selected =</span> <span class="st">"All States"</span>)),</span>
<span id="cb3-276"><a href="#cb3-276" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(<span class="dv">4</span>, <span class="fu">selectInput</span>(<span class="st">"industry_filter"</span>, <span class="st">"Select Industry:"</span>, </span>
<span id="cb3-277"><a href="#cb3-277" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"All Industries"</span>, <span class="fu">unique</span>(severe_injuries_data<span class="sc">$</span>industry)), </span>
<span id="cb3-278"><a href="#cb3-278" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">selected =</span> <span class="st">"All Industries"</span>))</span>
<span id="cb3-279"><a href="#cb3-279" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-280"><a href="#cb3-280" aria-hidden="true" tabindex="-1"></a>            <span class="fu">fluidRow</span>(</span>
<span id="cb3-281"><a href="#cb3-281" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(<span class="dv">4</span>, <span class="fu">selectInput</span>(<span class="st">"hospitalized_filter"</span>, <span class="st">"Hospitalized:"</span>, </span>
<span id="cb3-282"><a href="#cb3-282" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"Yes"</span>, <span class="st">"No"</span>), </span>
<span id="cb3-283"><a href="#cb3-283" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">selected =</span> <span class="st">"Yes"</span>)),</span>
<span id="cb3-284"><a href="#cb3-284" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(<span class="dv">4</span>, <span class="fu">selectInput</span>(<span class="st">"amputation_filter"</span>, <span class="st">"Amputation:"</span>, </span>
<span id="cb3-285"><a href="#cb3-285" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"Yes"</span>, <span class="st">"No"</span>), </span>
<span id="cb3-286"><a href="#cb3-286" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">selected =</span> <span class="st">"Yes"</span>)),</span>
<span id="cb3-287"><a href="#cb3-287" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(<span class="dv">4</span>, <span class="fu">selectInput</span>(<span class="st">"nature_filter"</span>, <span class="st">"Nature Category:"</span>, </span>
<span id="cb3-288"><a href="#cb3-288" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"All"</span>, <span class="fu">unique</span>(severe_injuries_data<span class="sc">$</span>nature_category)), </span>
<span id="cb3-289"><a href="#cb3-289" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">selected =</span> <span class="st">"All"</span>))</span>
<span id="cb3-290"><a href="#cb3-290" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-291"><a href="#cb3-291" aria-hidden="true" tabindex="-1"></a>            <span class="fu">fluidRow</span>(</span>
<span id="cb3-292"><a href="#cb3-292" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(<span class="dv">4</span>, <span class="fu">selectInput</span>(<span class="st">"body_part_filter"</span>, <span class="st">"Body Part:"</span>, </span>
<span id="cb3-293"><a href="#cb3-293" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"All"</span>, <span class="fu">unique</span>(severe_injuries_data<span class="sc">$</span>body_part)), </span>
<span id="cb3-294"><a href="#cb3-294" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">selected =</span> <span class="st">"All"</span>)),</span>
<span id="cb3-295"><a href="#cb3-295" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(<span class="dv">4</span>, <span class="fu">selectInput</span>(<span class="st">"event_filter"</span>, <span class="st">"Event Category:"</span>, </span>
<span id="cb3-296"><a href="#cb3-296" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"All"</span>, <span class="fu">unique</span>(severe_injuries_data<span class="sc">$</span>event_category)), </span>
<span id="cb3-297"><a href="#cb3-297" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">selected =</span> <span class="st">"All"</span>)),</span>
<span id="cb3-298"><a href="#cb3-298" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(<span class="dv">4</span>, <span class="fu">selectInput</span>(<span class="st">"source_filter"</span>, <span class="st">"Source Category:"</span>, </span>
<span id="cb3-299"><a href="#cb3-299" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"All"</span>, <span class="fu">unique</span>(severe_injuries_data<span class="sc">$</span>source_category)), </span>
<span id="cb3-300"><a href="#cb3-300" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">selected =</span> <span class="st">"All"</span>))</span>
<span id="cb3-301"><a href="#cb3-301" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-302"><a href="#cb3-302" aria-hidden="true" tabindex="-1"></a>            <span class="fu">fluidRow</span>(</span>
<span id="cb3-303"><a href="#cb3-303" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(<span class="dv">12</span>, <span class="at">style =</span> <span class="st">"margin-top: 20px;"</span>, </span>
<span id="cb3-304"><a href="#cb3-304" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">downloadButton</span>(<span class="st">"download_data"</span>, <span class="st">"Download Filtered Data"</span>, </span>
<span id="cb3-305"><a href="#cb3-305" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">style =</span> <span class="st">"float: right;"</span>))</span>
<span id="cb3-306"><a href="#cb3-306" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-307"><a href="#cb3-307" aria-hidden="true" tabindex="-1"></a>            <span class="fu">DTOutput</span>(<span class="st">"filtered_table"</span>)</span>
<span id="cb3-308"><a href="#cb3-308" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb3-309"><a href="#cb3-309" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-310"><a href="#cb3-310" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb3-311"><a href="#cb3-311" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-312"><a href="#cb3-312" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-313"><a href="#cb3-313" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb3-314"><a href="#cb3-314" aria-hidden="true" tabindex="-1"></a><span class="co"># Occupational Illness Page</span></span>
<span id="cb3-315"><a href="#cb3-315" aria-hidden="true" tabindex="-1"></a><span class="fu">hidden</span>(</span>
<span id="cb3-316"><a href="#cb3-316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">div</span>(</span>
<span id="cb3-317"><a href="#cb3-317" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="st">"occ-page"</span>,</span>
<span id="cb3-318"><a href="#cb3-318" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dashboardPage</span>(</span>
<span id="cb3-319"><a href="#cb3-319" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dashboardHeader</span>(</span>
<span id="cb3-320"><a href="#cb3-320" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">div</span>(</span>
<span id="cb3-321"><a href="#cb3-321" aria-hidden="true" tabindex="-1"></a>          <span class="fu">actionButton</span>(</span>
<span id="cb3-322"><a href="#cb3-322" aria-hidden="true" tabindex="-1"></a>            <span class="at">inputId =</span> <span class="st">"back_button_occ"</span>,</span>
<span id="cb3-323"><a href="#cb3-323" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="cn">NULL</span>,</span>
<span id="cb3-324"><a href="#cb3-324" aria-hidden="true" tabindex="-1"></a>            <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"arrow-left"</span>),</span>
<span id="cb3-325"><a href="#cb3-325" aria-hidden="true" tabindex="-1"></a>            <span class="at">style =</span> <span class="st">"margin-right: 0px; border: none; background-color: transparent; color: white;"</span></span>
<span id="cb3-326"><a href="#cb3-326" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb3-327"><a href="#cb3-327" aria-hidden="true" tabindex="-1"></a>          <span class="fu">span</span>(<span class="st">"Occupational Illness"</span>, <span class="at">style =</span> <span class="st">"font-size: 19px; padding-left: 0px;"</span>)</span>
<span id="cb3-328"><a href="#cb3-328" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-329"><a href="#cb3-329" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb3-330"><a href="#cb3-330" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dashboardSidebar</span>(</span>
<span id="cb3-331"><a href="#cb3-331" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sidebarMenu</span>(</span>
<span id="cb3-332"><a href="#cb3-332" aria-hidden="true" tabindex="-1"></a>          <span class="fu">menuItem</span>(<span class="st">"Illness by State"</span>, <span class="at">tabName =</span> <span class="st">"state_occ"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"map-marker-alt"</span>)),</span>
<span id="cb3-333"><a href="#cb3-333" aria-hidden="true" tabindex="-1"></a>          <span class="fu">menuItem</span>(<span class="st">"Top Industries"</span>, <span class="at">tabName =</span> <span class="st">"industries_occ"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"building"</span>)),</span>
<span id="cb3-334"><a href="#cb3-334" aria-hidden="true" tabindex="-1"></a>          <span class="fu">menuItem</span>(<span class="st">"Top States"</span>, <span class="at">tabName =</span> <span class="st">"states_occ"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"flag-checkered"</span>)),</span>
<span id="cb3-335"><a href="#cb3-335" aria-hidden="true" tabindex="-1"></a>          <span class="fu">menuItem</span>(<span class="st">"Key Injury Metrics by Industry"</span>, <span class="at">tabName =</span> <span class="st">"filter_industry_occ"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"industry"</span>)),</span>
<span id="cb3-336"><a href="#cb3-336" aria-hidden="true" tabindex="-1"></a>          <span class="fu">menuItem</span>(<span class="st">"Interactive Filters"</span>, <span class="at">tabName =</span> <span class="st">"filtering_occ"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"filter"</span>))</span>
<span id="cb3-337"><a href="#cb3-337" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-338"><a href="#cb3-338" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb3-339"><a href="#cb3-339" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dashboardBody</span>(</span>
<span id="cb3-340"><a href="#cb3-340" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tabItems</span>(</span>
<span id="cb3-341"><a href="#cb3-341" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Injuries by State Tab</span></span>
<span id="cb3-342"><a href="#cb3-342" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tabItem</span>(<span class="at">tabName =</span> <span class="st">"state_occ"</span>,</span>
<span id="cb3-343"><a href="#cb3-343" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">div</span>(</span>
<span id="cb3-344"><a href="#cb3-344" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">h2</span>(<span class="st">"Illnesses by State Analysis"</span>, </span>
<span id="cb3-345"><a href="#cb3-345" aria-hidden="true" tabindex="-1"></a>                       <span class="at">style =</span> <span class="st">"font-weight: bold; font-size: 3.5rem; text-align: center;"</span>)</span>
<span id="cb3-346"><a href="#cb3-346" aria-hidden="true" tabindex="-1"></a>                  ),</span>
<span id="cb3-347"><a href="#cb3-347" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">sliderInput</span>(</span>
<span id="cb3-348"><a href="#cb3-348" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"year_occ"</span>,</span>
<span id="cb3-349"><a href="#cb3-349" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Select Year:"</span>,</span>
<span id="cb3-350"><a href="#cb3-350" aria-hidden="true" tabindex="-1"></a>                    <span class="at">min =</span> <span class="dv">2016</span>,</span>
<span id="cb3-351"><a href="#cb3-351" aria-hidden="true" tabindex="-1"></a>                    <span class="at">max =</span> <span class="dv">2022</span>,</span>
<span id="cb3-352"><a href="#cb3-352" aria-hidden="true" tabindex="-1"></a>                    <span class="at">value =</span> <span class="dv">2022</span>,</span>
<span id="cb3-353"><a href="#cb3-353" aria-hidden="true" tabindex="-1"></a>                    <span class="at">step =</span> <span class="dv">1</span>,</span>
<span id="cb3-354"><a href="#cb3-354" aria-hidden="true" tabindex="-1"></a>                    <span class="at">animate =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-355"><a href="#cb3-355" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb3-356"><a href="#cb3-356" aria-hidden="true" tabindex="-1"></a>                  ),</span>
<span id="cb3-357"><a href="#cb3-357" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">plotlyOutput</span>(<span class="st">"state_plot_occ"</span>)</span>
<span id="cb3-358"><a href="#cb3-358" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb3-359"><a href="#cb3-359" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Top Industries Tab</span></span>
<span id="cb3-360"><a href="#cb3-360" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tabItem</span>(</span>
<span id="cb3-361"><a href="#cb3-361" aria-hidden="true" tabindex="-1"></a>            <span class="at">tabName =</span> <span class="st">"industries_occ"</span>,</span>
<span id="cb3-362"><a href="#cb3-362" aria-hidden="true" tabindex="-1"></a>            <span class="fu">h2</span>(<span class="st">"Top Industries Analysis"</span>,</span>
<span id="cb3-363"><a href="#cb3-363" aria-hidden="true" tabindex="-1"></a>               <span class="at">style =</span> <span class="st">"font-weight: bold; font-size: 3.5rem; text-align: center;"</span>),</span>
<span id="cb3-364"><a href="#cb3-364" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sliderInput</span>(</span>
<span id="cb3-365"><a href="#cb3-365" aria-hidden="true" tabindex="-1"></a>              <span class="st">"year_industry_occ"</span>,</span>
<span id="cb3-366"><a href="#cb3-366" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Select Year:"</span>,</span>
<span id="cb3-367"><a href="#cb3-367" aria-hidden="true" tabindex="-1"></a>              <span class="at">min =</span> <span class="dv">2016</span>,</span>
<span id="cb3-368"><a href="#cb3-368" aria-hidden="true" tabindex="-1"></a>              <span class="at">max =</span> <span class="dv">2022</span>,</span>
<span id="cb3-369"><a href="#cb3-369" aria-hidden="true" tabindex="-1"></a>              <span class="at">value =</span> <span class="dv">2022</span>,</span>
<span id="cb3-370"><a href="#cb3-370" aria-hidden="true" tabindex="-1"></a>              <span class="at">step =</span> <span class="dv">1</span>,</span>
<span id="cb3-371"><a href="#cb3-371" aria-hidden="true" tabindex="-1"></a>              <span class="at">animate =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-372"><a href="#cb3-372" aria-hidden="true" tabindex="-1"></a>              <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb3-373"><a href="#cb3-373" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-374"><a href="#cb3-374" aria-hidden="true" tabindex="-1"></a>            <span class="fu">fluidRow</span>(</span>
<span id="cb3-375"><a href="#cb3-375" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(<span class="dv">12</span>, <span class="at">style =</span> <span class="st">"margin-top: 20px;"</span>, </span>
<span id="cb3-376"><a href="#cb3-376" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">downloadButton</span>(<span class="st">"download_industry_plot_occ"</span>, <span class="st">"Download Filtered Data"</span>, </span>
<span id="cb3-377"><a href="#cb3-377" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">style =</span> <span class="st">"float: right;"</span>))</span>
<span id="cb3-378"><a href="#cb3-378" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-379"><a href="#cb3-379" aria-hidden="true" tabindex="-1"></a>            <span class="fu">plotOutput</span>(<span class="st">"industry_pie_chart_occ"</span>),</span>
<span id="cb3-380"><a href="#cb3-380" aria-hidden="true" tabindex="-1"></a>            <span class="fu">h4</span>(<span class="st">"Complete List of all Industries"</span>, <span class="at">style =</span> <span class="st">"margin-top: 20px; font-weight: bold; text-align: left;"</span>),</span>
<span id="cb3-381"><a href="#cb3-381" aria-hidden="true" tabindex="-1"></a>            <span class="fu">tableOutput</span>(<span class="st">"industry_table_occ"</span>)</span>
<span id="cb3-382"><a href="#cb3-382" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb3-383"><a href="#cb3-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-384"><a href="#cb3-384" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Top States Tab</span></span>
<span id="cb3-385"><a href="#cb3-385" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tabItem</span>(</span>
<span id="cb3-386"><a href="#cb3-386" aria-hidden="true" tabindex="-1"></a>            <span class="at">tabName =</span> <span class="st">"states_occ"</span>,</span>
<span id="cb3-387"><a href="#cb3-387" aria-hidden="true" tabindex="-1"></a>            <span class="fu">h2</span>(<span class="st">"Top States Analysis"</span>,</span>
<span id="cb3-388"><a href="#cb3-388" aria-hidden="true" tabindex="-1"></a>               <span class="at">style =</span> <span class="st">"font-weight: bold; font-size: 3.5rem; text-align: center;"</span>),</span>
<span id="cb3-389"><a href="#cb3-389" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sliderInput</span>(</span>
<span id="cb3-390"><a href="#cb3-390" aria-hidden="true" tabindex="-1"></a>              <span class="st">"year_state_occ"</span>,</span>
<span id="cb3-391"><a href="#cb3-391" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Select Year:"</span>,</span>
<span id="cb3-392"><a href="#cb3-392" aria-hidden="true" tabindex="-1"></a>              <span class="at">min =</span> <span class="dv">2016</span>,</span>
<span id="cb3-393"><a href="#cb3-393" aria-hidden="true" tabindex="-1"></a>              <span class="at">max =</span> <span class="dv">2022</span>,</span>
<span id="cb3-394"><a href="#cb3-394" aria-hidden="true" tabindex="-1"></a>              <span class="at">value =</span> <span class="dv">2022</span>,</span>
<span id="cb3-395"><a href="#cb3-395" aria-hidden="true" tabindex="-1"></a>              <span class="at">step =</span> <span class="dv">1</span>,</span>
<span id="cb3-396"><a href="#cb3-396" aria-hidden="true" tabindex="-1"></a>              <span class="at">animate =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-397"><a href="#cb3-397" aria-hidden="true" tabindex="-1"></a>              <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb3-398"><a href="#cb3-398" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-399"><a href="#cb3-399" aria-hidden="true" tabindex="-1"></a>            <span class="fu">fluidRow</span>(</span>
<span id="cb3-400"><a href="#cb3-400" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(<span class="dv">12</span>, <span class="at">style =</span> <span class="st">"margin-top: 20px;"</span>, </span>
<span id="cb3-401"><a href="#cb3-401" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">downloadButton</span>(<span class="st">"download_top_states_plot_occ"</span>, <span class="st">"Download Filtered Data"</span>, </span>
<span id="cb3-402"><a href="#cb3-402" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">style =</span> <span class="st">"float: right;"</span>))</span>
<span id="cb3-403"><a href="#cb3-403" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-404"><a href="#cb3-404" aria-hidden="true" tabindex="-1"></a>            <span class="fu">plotOutput</span>(<span class="st">"top_states_plot_occ"</span>),</span>
<span id="cb3-405"><a href="#cb3-405" aria-hidden="true" tabindex="-1"></a>            <span class="fu">h4</span>(<span class="st">"Complete List of States"</span>, <span class="at">style =</span> <span class="st">"margin-top: 20px; font-weight: bold; text-align: left;"</span>),</span>
<span id="cb3-406"><a href="#cb3-406" aria-hidden="true" tabindex="-1"></a>            <span class="fu">tableOutput</span>(<span class="st">"states_table_occ"</span>)</span>
<span id="cb3-407"><a href="#cb3-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-408"><a href="#cb3-408" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb3-409"><a href="#cb3-409" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Key Injury Metrics by Industry Tab</span></span>
<span id="cb3-410"><a href="#cb3-410" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tabItem</span>(</span>
<span id="cb3-411"><a href="#cb3-411" aria-hidden="true" tabindex="-1"></a>            <span class="at">tabName =</span> <span class="st">"filter_industry_occ"</span>,</span>
<span id="cb3-412"><a href="#cb3-412" aria-hidden="true" tabindex="-1"></a>            <span class="fu">h2</span>(<span class="st">"Key Injury Metrics by Industry"</span>,</span>
<span id="cb3-413"><a href="#cb3-413" aria-hidden="true" tabindex="-1"></a>               <span class="at">style =</span> <span class="st">"font-weight: bold; font-size: 3.5rem; text-align: center;"</span>),</span>
<span id="cb3-414"><a href="#cb3-414" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sliderInput</span>(</span>
<span id="cb3-415"><a href="#cb3-415" aria-hidden="true" tabindex="-1"></a>              <span class="st">"year_filter_industry_occ"</span>,</span>
<span id="cb3-416"><a href="#cb3-416" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Select Year:"</span>,</span>
<span id="cb3-417"><a href="#cb3-417" aria-hidden="true" tabindex="-1"></a>              <span class="at">min =</span> <span class="dv">2016</span>,</span>
<span id="cb3-418"><a href="#cb3-418" aria-hidden="true" tabindex="-1"></a>              <span class="at">max =</span> <span class="dv">2022</span>,</span>
<span id="cb3-419"><a href="#cb3-419" aria-hidden="true" tabindex="-1"></a>              <span class="at">value =</span> <span class="dv">2022</span>,</span>
<span id="cb3-420"><a href="#cb3-420" aria-hidden="true" tabindex="-1"></a>              <span class="at">step =</span> <span class="dv">1</span>,</span>
<span id="cb3-421"><a href="#cb3-421" aria-hidden="true" tabindex="-1"></a>              <span class="at">animate =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-422"><a href="#cb3-422" aria-hidden="true" tabindex="-1"></a>              <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb3-423"><a href="#cb3-423" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-424"><a href="#cb3-424" aria-hidden="true" tabindex="-1"></a>            <span class="fu">selectInput</span>(</span>
<span id="cb3-425"><a href="#cb3-425" aria-hidden="true" tabindex="-1"></a>              <span class="st">"select_industry_occ"</span>,</span>
<span id="cb3-426"><a href="#cb3-426" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Select Industry:"</span>,</span>
<span id="cb3-427"><a href="#cb3-427" aria-hidden="true" tabindex="-1"></a>              <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"All Industries"</span>, <span class="fu">unique</span>(occ_injuries_data<span class="sc">$</span>industry)),</span>
<span id="cb3-428"><a href="#cb3-428" aria-hidden="true" tabindex="-1"></a>              <span class="at">selected =</span> <span class="st">"All Industries"</span>,</span>
<span id="cb3-429"><a href="#cb3-429" aria-hidden="true" tabindex="-1"></a>              <span class="at">multiple =</span> <span class="cn">FALSE</span></span>
<span id="cb3-430"><a href="#cb3-430" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-431"><a href="#cb3-431" aria-hidden="true" tabindex="-1"></a>            <span class="fu">uiOutput</span>(<span class="st">"dynamic_title"</span>),</span>
<span id="cb3-432"><a href="#cb3-432" aria-hidden="true" tabindex="-1"></a>            <span class="fu">fluidRow</span>(</span>
<span id="cb3-433"><a href="#cb3-433" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(<span class="dv">12</span>, <span class="at">style =</span> <span class="st">"margin-top: 20px;"</span>, </span>
<span id="cb3-434"><a href="#cb3-434" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">downloadButton</span>(<span class="st">"download_industry_interactive_plots"</span>, <span class="st">"Download Filtered Data"</span>, </span>
<span id="cb3-435"><a href="#cb3-435" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">style =</span> <span class="st">"float: right;"</span>))</span>
<span id="cb3-436"><a href="#cb3-436" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-437"><a href="#cb3-437" aria-hidden="true" tabindex="-1"></a>            <span class="fu">fluidRow</span>(</span>
<span id="cb3-438"><a href="#cb3-438" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(<span class="dv">4</span>, <span class="fu">plotOutput</span>(<span class="st">"illness_employees_plot_occ"</span>)),</span>
<span id="cb3-439"><a href="#cb3-439" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(<span class="dv">4</span>, <span class="fu">plotOutput</span>(<span class="st">"illness_deaths_plot_occ"</span>)),</span>
<span id="cb3-440"><a href="#cb3-440" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(<span class="dv">4</span>, <span class="fu">plotOutput</span>(<span class="st">"illness_cases_plot_occ"</span>))</span>
<span id="cb3-441"><a href="#cb3-441" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-442"><a href="#cb3-442" aria-hidden="true" tabindex="-1"></a>            <span class="fu">fluidRow</span>(</span>
<span id="cb3-443"><a href="#cb3-443" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(<span class="dv">4</span>, <span class="fu">plotOutput</span>(<span class="st">"illness_days_plot_occ"</span>)),</span>
<span id="cb3-444"><a href="#cb3-444" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(<span class="dv">8</span>, <span class="fu">plotOutput</span>(<span class="st">"illness_categories_plot_occ"</span>))</span>
<span id="cb3-445"><a href="#cb3-445" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb3-446"><a href="#cb3-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-447"><a href="#cb3-447" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb3-448"><a href="#cb3-448" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Interactive Filters Tab</span></span>
<span id="cb3-449"><a href="#cb3-449" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tabItem</span>(</span>
<span id="cb3-450"><a href="#cb3-450" aria-hidden="true" tabindex="-1"></a>            <span class="at">tabName =</span> <span class="st">"filtering_occ"</span>,</span>
<span id="cb3-451"><a href="#cb3-451" aria-hidden="true" tabindex="-1"></a>            <span class="fu">h2</span>(<span class="st">"Interactive Filters for Occupational Illness"</span>,</span>
<span id="cb3-452"><a href="#cb3-452" aria-hidden="true" tabindex="-1"></a>               <span class="at">style =</span> <span class="st">"font-weight: bold; font-size: 3.5rem; text-align: center;"</span>),</span>
<span id="cb3-453"><a href="#cb3-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-454"><a href="#cb3-454" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Filters for the page</span></span>
<span id="cb3-455"><a href="#cb3-455" aria-hidden="true" tabindex="-1"></a>            <span class="fu">fluidRow</span>(</span>
<span id="cb3-456"><a href="#cb3-456" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(</span>
<span id="cb3-457"><a href="#cb3-457" aria-hidden="true" tabindex="-1"></a>                <span class="dv">4</span>,</span>
<span id="cb3-458"><a href="#cb3-458" aria-hidden="true" tabindex="-1"></a>                <span class="fu">sliderInput</span>(</span>
<span id="cb3-459"><a href="#cb3-459" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"year_filter_occ"</span>,</span>
<span id="cb3-460"><a href="#cb3-460" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Select Year:"</span>,</span>
<span id="cb3-461"><a href="#cb3-461" aria-hidden="true" tabindex="-1"></a>                  <span class="at">min =</span> <span class="dv">2016</span>,</span>
<span id="cb3-462"><a href="#cb3-462" aria-hidden="true" tabindex="-1"></a>                  <span class="at">max =</span> <span class="dv">2022</span>,</span>
<span id="cb3-463"><a href="#cb3-463" aria-hidden="true" tabindex="-1"></a>                  <span class="at">value =</span> <span class="dv">2022</span>,</span>
<span id="cb3-464"><a href="#cb3-464" aria-hidden="true" tabindex="-1"></a>                  <span class="at">step =</span> <span class="dv">1</span>,</span>
<span id="cb3-465"><a href="#cb3-465" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb3-466"><a href="#cb3-466" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb3-467"><a href="#cb3-467" aria-hidden="true" tabindex="-1"></a>              ),</span>
<span id="cb3-468"><a href="#cb3-468" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(</span>
<span id="cb3-469"><a href="#cb3-469" aria-hidden="true" tabindex="-1"></a>                <span class="dv">4</span>,</span>
<span id="cb3-470"><a href="#cb3-470" aria-hidden="true" tabindex="-1"></a>                <span class="fu">selectInput</span>(</span>
<span id="cb3-471"><a href="#cb3-471" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"industry_filter_occ"</span>,</span>
<span id="cb3-472"><a href="#cb3-472" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Select Industry:"</span>,</span>
<span id="cb3-473"><a href="#cb3-473" aria-hidden="true" tabindex="-1"></a>                  <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"All Industries"</span>, <span class="fu">unique</span>(occ_injuries_data<span class="sc">$</span>industry)),</span>
<span id="cb3-474"><a href="#cb3-474" aria-hidden="true" tabindex="-1"></a>                  <span class="at">selected =</span> <span class="st">"All Industries"</span></span>
<span id="cb3-475"><a href="#cb3-475" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb3-476"><a href="#cb3-476" aria-hidden="true" tabindex="-1"></a>              ),</span>
<span id="cb3-477"><a href="#cb3-477" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(</span>
<span id="cb3-478"><a href="#cb3-478" aria-hidden="true" tabindex="-1"></a>                <span class="dv">4</span>,</span>
<span id="cb3-479"><a href="#cb3-479" aria-hidden="true" tabindex="-1"></a>                <span class="fu">selectInput</span>(</span>
<span id="cb3-480"><a href="#cb3-480" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"state_filter_occ"</span>,</span>
<span id="cb3-481"><a href="#cb3-481" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Select State:"</span>,</span>
<span id="cb3-482"><a href="#cb3-482" aria-hidden="true" tabindex="-1"></a>                  <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"All States"</span>, <span class="fu">unique</span>(occ_injuries_data<span class="sc">$</span>state)),</span>
<span id="cb3-483"><a href="#cb3-483" aria-hidden="true" tabindex="-1"></a>                  <span class="at">selected =</span> <span class="st">"All States"</span></span>
<span id="cb3-484"><a href="#cb3-484" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb3-485"><a href="#cb3-485" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb3-486"><a href="#cb3-486" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-487"><a href="#cb3-487" aria-hidden="true" tabindex="-1"></a>            <span class="fu">fluidRow</span>(</span>
<span id="cb3-488"><a href="#cb3-488" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(</span>
<span id="cb3-489"><a href="#cb3-489" aria-hidden="true" tabindex="-1"></a>                <span class="dv">4</span>,</span>
<span id="cb3-490"><a href="#cb3-490" aria-hidden="true" tabindex="-1"></a>                <span class="fu">selectInput</span>(</span>
<span id="cb3-491"><a href="#cb3-491" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"illness_injuries_filter_occ"</span>,</span>
<span id="cb3-492"><a href="#cb3-492" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Illness:"</span>,</span>
<span id="cb3-493"><a href="#cb3-493" aria-hidden="true" tabindex="-1"></a>                  <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"Yes"</span>, <span class="st">"No"</span>),</span>
<span id="cb3-494"><a href="#cb3-494" aria-hidden="true" tabindex="-1"></a>                  <span class="at">selected =</span> <span class="st">"Yes"</span></span>
<span id="cb3-495"><a href="#cb3-495" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb3-496"><a href="#cb3-496" aria-hidden="true" tabindex="-1"></a>              ),</span>
<span id="cb3-497"><a href="#cb3-497" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(</span>
<span id="cb3-498"><a href="#cb3-498" aria-hidden="true" tabindex="-1"></a>                <span class="dv">4</span>,</span>
<span id="cb3-499"><a href="#cb3-499" aria-hidden="true" tabindex="-1"></a>                <span class="fu">selectInput</span>(</span>
<span id="cb3-500"><a href="#cb3-500" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"respiratory_conditions_filter_occ"</span>,</span>
<span id="cb3-501"><a href="#cb3-501" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Respiratory Conditions:"</span>,</span>
<span id="cb3-502"><a href="#cb3-502" aria-hidden="true" tabindex="-1"></a>                  <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>),</span>
<span id="cb3-503"><a href="#cb3-503" aria-hidden="true" tabindex="-1"></a>                  <span class="at">selected =</span> <span class="st">"No"</span></span>
<span id="cb3-504"><a href="#cb3-504" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb3-505"><a href="#cb3-505" aria-hidden="true" tabindex="-1"></a>              ),</span>
<span id="cb3-506"><a href="#cb3-506" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(</span>
<span id="cb3-507"><a href="#cb3-507" aria-hidden="true" tabindex="-1"></a>                <span class="dv">4</span>,</span>
<span id="cb3-508"><a href="#cb3-508" aria-hidden="true" tabindex="-1"></a>                <span class="fu">selectInput</span>(</span>
<span id="cb3-509"><a href="#cb3-509" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"skin_disorder_filter_occ"</span>,</span>
<span id="cb3-510"><a href="#cb3-510" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Skin Disorder:"</span>,</span>
<span id="cb3-511"><a href="#cb3-511" aria-hidden="true" tabindex="-1"></a>                  <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"Yes"</span>, <span class="st">"No"</span>),</span>
<span id="cb3-512"><a href="#cb3-512" aria-hidden="true" tabindex="-1"></a>                  <span class="at">selected =</span> <span class="st">"No"</span></span>
<span id="cb3-513"><a href="#cb3-513" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb3-514"><a href="#cb3-514" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb3-515"><a href="#cb3-515" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-516"><a href="#cb3-516" aria-hidden="true" tabindex="-1"></a>            <span class="fu">fluidRow</span>(</span>
<span id="cb3-517"><a href="#cb3-517" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(</span>
<span id="cb3-518"><a href="#cb3-518" aria-hidden="true" tabindex="-1"></a>                <span class="dv">4</span>,</span>
<span id="cb3-519"><a href="#cb3-519" aria-hidden="true" tabindex="-1"></a>                <span class="fu">selectInput</span>(</span>
<span id="cb3-520"><a href="#cb3-520" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"hearing_loss_filter_occ"</span>,</span>
<span id="cb3-521"><a href="#cb3-521" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Hearing Loss:"</span>,</span>
<span id="cb3-522"><a href="#cb3-522" aria-hidden="true" tabindex="-1"></a>                  <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"Yes"</span>, <span class="st">"No"</span>),</span>
<span id="cb3-523"><a href="#cb3-523" aria-hidden="true" tabindex="-1"></a>                  <span class="at">selected =</span> <span class="st">"No"</span></span>
<span id="cb3-524"><a href="#cb3-524" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb3-525"><a href="#cb3-525" aria-hidden="true" tabindex="-1"></a>              ),</span>
<span id="cb3-526"><a href="#cb3-526" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(</span>
<span id="cb3-527"><a href="#cb3-527" aria-hidden="true" tabindex="-1"></a>                <span class="dv">4</span>,</span>
<span id="cb3-528"><a href="#cb3-528" aria-hidden="true" tabindex="-1"></a>                <span class="fu">selectInput</span>(</span>
<span id="cb3-529"><a href="#cb3-529" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"other_illness_filter_occ"</span>,</span>
<span id="cb3-530"><a href="#cb3-530" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Other Illness:"</span>,</span>
<span id="cb3-531"><a href="#cb3-531" aria-hidden="true" tabindex="-1"></a>                  <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"Yes"</span>, <span class="st">"No"</span>),</span>
<span id="cb3-532"><a href="#cb3-532" aria-hidden="true" tabindex="-1"></a>                  <span class="at">selected =</span> <span class="st">"No"</span></span>
<span id="cb3-533"><a href="#cb3-533" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb3-534"><a href="#cb3-534" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb3-535"><a href="#cb3-535" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-536"><a href="#cb3-536" aria-hidden="true" tabindex="-1"></a>            <span class="fu">fluidRow</span>(</span>
<span id="cb3-537"><a href="#cb3-537" aria-hidden="true" tabindex="-1"></a>              <span class="fu">column</span>(<span class="dv">12</span>, <span class="at">style =</span> <span class="st">"margin-top: 20px;"</span>, </span>
<span id="cb3-538"><a href="#cb3-538" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">downloadButton</span>(<span class="st">"download_occ_data"</span>, <span class="st">"Download Filtered Data"</span>, </span>
<span id="cb3-539"><a href="#cb3-539" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">style =</span> <span class="st">"float: right;"</span>))</span>
<span id="cb3-540"><a href="#cb3-540" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb3-541"><a href="#cb3-541" aria-hidden="true" tabindex="-1"></a>            <span class="fu">DTOutput</span>(<span class="st">"filtered_table_occ"</span>)</span>
<span id="cb3-542"><a href="#cb3-542" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb3-543"><a href="#cb3-543" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-544"><a href="#cb3-544" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb3-545"><a href="#cb3-545" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-546"><a href="#cb3-546" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-547"><a href="#cb3-547" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-548"><a href="#cb3-548" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="step-3-functionality-of-the-shiny-ui-dashboard" class="level2">
<h2 class="anchored" data-anchor-id="step-3-functionality-of-the-shiny-ui-dashboard">Step 3: Functionality of the Shiny UI Dashboard</h2>
<p>In the below server function of the Shiny app is where the main logic for rendering UI elements and handling user interactions is implemented. In Shiny, the server function defines the behavior of the app, such as how the app reacts to user input and how it generates dynamic content (e.g., plots, tables, etc.). It takes user inputs, processes them, and outputs the results to the UI.</p>
<p>Here’s a breakdown of what the below server function does:</p>
<ul>
<li>Rendering Plots and Charts</li>
<li>User Interactions (Buttons and Inputs)</li>
<li>Dynamic Table Rendering</li>
<li>Downloadable Reports</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Show dashboard page when 'Get Started' button is clicked</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>get_started_btn, {</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hide</span>(<span class="st">"welcome-page"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">show</span>(<span class="st">"dashboard-page"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Show severe injuries page when 'Severe Injuries' button is clicked</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>severe_btn, {</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hide</span>(<span class="st">"dashboard-page"</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">show</span>(<span class="st">"severe-page"</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Show occupational injuries page when 'Occupational Injuries' button is clicked</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>occupational_btn, {</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hide</span>(<span class="st">"dashboard-page"</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">show</span>(<span class="st">"occ-page"</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Handle Back Button on Severe Injuries page</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>back_button, {</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">show</span>(<span class="st">"dashboard-page"</span>)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hide</span>(<span class="st">"severe-page"</span>)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Handle Back Button on Occupational Injuries page</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>back_button_occ, {</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">show</span>(<span class="st">"dashboard-page"</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hide</span>(<span class="st">"occ-page"</span>)</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># SEVERE INJURIES</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Injuries by State Analysis</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Map plot for total injuries across all the states in US </span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>state_plot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter and summarize data by state and year</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    state_summary <span class="ot">&lt;-</span> severe_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> input<span class="sc">$</span>year) <span class="sc">|&gt;</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">Total_Injuries =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert state names to lowercase for map matching</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>    state_summary<span class="sc">$</span>state <span class="ot">&lt;-</span> <span class="fu">tolower</span>(state_summary<span class="sc">$</span>state)</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load US state map data</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    us_states <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">"state"</span>)</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine map data with injury data</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    map_data_combined <span class="ot">&lt;-</span> us_states <span class="sc">|&gt;</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(state_summary, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"region"</span> <span class="ot">=</span> <span class="st">"state"</span>))</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create hover text for map</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>    map_data_combined<span class="sc">$</span>hover_text <span class="ot">&lt;-</span> <span class="fu">paste</span>(</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>      <span class="st">"State:"</span>, map_data_combined<span class="sc">$</span>region,</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&lt;br&gt;Total Injuries:"</span>, map_data_combined<span class="sc">$</span>Total_Injuries</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create and customize the map plot</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(map_data_combined, <span class="fu">aes</span>(</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group, <span class="at">fill =</span> Total_Injuries, <span class="at">text =</span> hover_text</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_polygon</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_fixed</span>(<span class="fl">1.3</span>) <span class="sc">+</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"#336699"</span>, <span class="at">high =</span> <span class="st">"#003366"</span>, <span class="at">na.value =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Total Severe Injuries by State for"</span>, input<span class="sc">$</span>year),</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"Total Injuries"</span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert ggplot to Plotly for interactive features</span></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplotly</span>(p, <span class="at">tooltip =</span> <span class="st">"text"</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>      <span class="fu">layout</span>(</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>        <span class="at">hoverlabel =</span> <span class="fu">list</span>(<span class="at">bgcolor =</span> <span class="st">"white"</span>, <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">12</span>)),</span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>        <span class="at">hovermode =</span> <span class="st">"closest"</span></span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>      <span class="fu">config</span>(</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>        <span class="at">modeBarButtonsToRemove =</span> <span class="fu">c</span>(</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>          <span class="st">"pan2d"</span>, <span class="st">"select2d"</span>, <span class="st">"lasso2d"</span>, <span class="st">"autoScale2d"</span>, <span class="st">"resetScale2d"</span>, </span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>          <span class="st">"hoverClosestCartesian"</span>, <span class="st">"hoverCompareCartesian"</span>, </span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>          <span class="st">"zoom2d"</span>, <span class="st">"sendDataToCloud"</span></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>        <span class="at">displaylogo =</span> <span class="cn">FALSE</span> </span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Visualization for hospitalization and amputation</span></span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>hospitalization_amputation_plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Summarize data for hospitalizations and amputations based on the selected year</span></span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>    summary_data <span class="ot">&lt;-</span> severe_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> input<span class="sc">$</span>year) <span class="sc">|&gt;</span></span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(</span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Total Hospitalizations</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(hospitalization <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">No Hospitalization</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(hospitalization <span class="sc">==</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Total Amputations</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(amputation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">No Amputation</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(amputation <span class="sc">==</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>      tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">Total Hospitalizations</span><span class="st">`</span>, <span class="st">`</span><span class="at">No Hospitalization</span><span class="st">`</span>, <span class="st">`</span><span class="at">Total Amputations</span><span class="st">`</span>, <span class="st">`</span><span class="at">No Amputation</span><span class="st">`</span>), </span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>                          <span class="at">names_to =</span> <span class="st">"Type"</span>, </span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>                          <span class="at">values_to =</span> <span class="st">"Count"</span>)</span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create bar plot for hospitalizations and amputations with counts for each category</span></span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(summary_data, <span class="fu">aes</span>(<span class="at">x =</span> Type, <span class="at">y =</span> Count, <span class="at">fill =</span> Type)) <span class="sc">+</span></span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.6</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Count), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Total Hospitalizations and Amputations in"</span>, input<span class="sc">$</span>year),</span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Total Count"</span></span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Total Hospitalizations"</span> <span class="ot">=</span> <span class="st">"#003366"</span>, </span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a>        <span class="st">"No Hospitalization"</span> <span class="ot">=</span> <span class="st">"#336699"</span>, </span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Total Amputations"</span> <span class="ot">=</span> <span class="st">"#4d4d4d"</span>, </span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a>        <span class="st">"No Amputation"</span> <span class="ot">=</span> <span class="st">"#99ccff"</span></span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a>      )) <span class="sc">+</span></span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_cartesian</span>(<span class="at">clip =</span> <span class="st">"off"</span>)</span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Top Industries Analysis</span></span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Render pie chart of the top 5 industries with the highest number of severe injuries</span></span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>industry_pie_chart <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data based on selected year, group by industry, and calculate total injuries per industry</span></span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a>    industry_data <span class="ot">&lt;-</span> severe_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> input<span class="sc">$</span>year_industry) <span class="sc">|&gt;</span></span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(industry) <span class="sc">|&gt;</span></span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">Total_Injuries =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(Total_Injuries)) <span class="sc">|&gt;</span></span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Percentage =</span> <span class="fu">round</span>((Total_Injuries <span class="sc">/</span> <span class="fu">sum</span>(Total_Injuries)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a>    custom_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#336699"</span>, <span class="st">"#003366"</span>, <span class="st">"#4d4d4d"</span>, <span class="st">"#99ccff"</span>, <span class="st">"#1a1a1a"</span>)</span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create pie chart with custom colors and labels</span></span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(industry_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> Total_Injuries, <span class="at">fill =</span> industry)) <span class="sc">+</span></span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb4-158"><a href="#cb4-158" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(Percentage, <span class="st">"%"</span>)),</span>
<span id="cb4-159"><a href="#cb4-159" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb4-160"><a href="#cb4-160" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb4-161"><a href="#cb4-161" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Top 5 Industries for Severe Injuries in"</span>, input<span class="sc">$</span>year_industry),</span>
<span id="cb4-162"><a href="#cb4-162" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"Industry"</span></span>
<span id="cb4-163"><a href="#cb4-163" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-164"><a href="#cb4-164" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb4-165"><a href="#cb4-165" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb4-166"><a href="#cb4-166" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb4-167"><a href="#cb4-167" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb4-168"><a href="#cb4-168" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb4-169"><a href="#cb4-169" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-170"><a href="#cb4-170" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors)</span>
<span id="cb4-171"><a href="#cb4-171" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-172"><a href="#cb4-172" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-173"><a href="#cb4-173" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Render table showing total injuries and percentage of injuries by industry</span></span>
<span id="cb4-174"><a href="#cb4-174" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>industry_table <span class="ot">&lt;-</span> <span class="fu">renderTable</span>({</span>
<span id="cb4-175"><a href="#cb4-175" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate total number of injuries for the selected year</span></span>
<span id="cb4-176"><a href="#cb4-176" aria-hidden="true" tabindex="-1"></a>    total_injuries <span class="ot">&lt;-</span> severe_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-177"><a href="#cb4-177" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> input<span class="sc">$</span>year_industry) <span class="sc">|&gt;</span></span>
<span id="cb4-178"><a href="#cb4-178" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">Total_Injuries =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-179"><a href="#cb4-179" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(Total_Injuries)</span>
<span id="cb4-180"><a href="#cb4-180" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-181"><a href="#cb4-181" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Summarize injuries by industry, calculate percentage for each industry</span></span>
<span id="cb4-182"><a href="#cb4-182" aria-hidden="true" tabindex="-1"></a>    industry_data <span class="ot">&lt;-</span> severe_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-183"><a href="#cb4-183" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> input<span class="sc">$</span>year_industry) <span class="sc">|&gt;</span></span>
<span id="cb4-184"><a href="#cb4-184" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(industry) <span class="sc">|&gt;</span></span>
<span id="cb4-185"><a href="#cb4-185" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">Total_Injuries =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-186"><a href="#cb4-186" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(Total_Injuries)) <span class="sc">|&gt;</span></span>
<span id="cb4-187"><a href="#cb4-187" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Percentage =</span> <span class="fu">round</span>((Total_Injuries <span class="sc">/</span> total_injuries) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-188"><a href="#cb4-188" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(</span>
<span id="cb4-189"><a href="#cb4-189" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Industry</span><span class="st">`</span> <span class="ot">=</span> industry,</span>
<span id="cb4-190"><a href="#cb4-190" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Total Injuries</span><span class="st">`</span> <span class="ot">=</span> Total_Injuries,</span>
<span id="cb4-191"><a href="#cb4-191" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Percentage (%)</span><span class="st">`</span> <span class="ot">=</span> Percentage</span>
<span id="cb4-192"><a href="#cb4-192" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-193"><a href="#cb4-193" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the summarized data as a table</span></span>
<span id="cb4-194"><a href="#cb4-194" aria-hidden="true" tabindex="-1"></a>    industry_data</span>
<span id="cb4-195"><a href="#cb4-195" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-196"><a href="#cb4-196" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-197"><a href="#cb4-197" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Download the top industries pie chart as a PNG image</span></span>
<span id="cb4-198"><a href="#cb4-198" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>download_industry_plot <span class="ot">&lt;-</span> <span class="fu">downloadHandler</span>(</span>
<span id="cb4-199"><a href="#cb4-199" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define filename format for the downloaded image</span></span>
<span id="cb4-200"><a href="#cb4-200" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="cf">function</span>() {</span>
<span id="cb4-201"><a href="#cb4-201" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(<span class="st">"top_industries_pie_chart_"</span>, <span class="fu">Sys.time</span>(), <span class="st">".png"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb4-202"><a href="#cb4-202" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb4-203"><a href="#cb4-203" aria-hidden="true" tabindex="-1"></a>    <span class="at">content =</span> <span class="cf">function</span>(file) {</span>
<span id="cb4-204"><a href="#cb4-204" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Generate the top 5 industries data for the pie chart</span></span>
<span id="cb4-205"><a href="#cb4-205" aria-hidden="true" tabindex="-1"></a>      industry_data <span class="ot">&lt;-</span> severe_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-206"><a href="#cb4-206" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(year <span class="sc">==</span> input<span class="sc">$</span>year_industry) <span class="sc">|&gt;</span></span>
<span id="cb4-207"><a href="#cb4-207" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(industry) <span class="sc">|&gt;</span></span>
<span id="cb4-208"><a href="#cb4-208" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">Total_Injuries =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-209"><a href="#cb4-209" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(<span class="fu">desc</span>(Total_Injuries)) <span class="sc">|&gt;</span></span>
<span id="cb4-210"><a href="#cb4-210" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">Percentage =</span> <span class="fu">round</span>((Total_Injuries <span class="sc">/</span> <span class="fu">sum</span>(Total_Injuries)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-211"><a href="#cb4-211" aria-hidden="true" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb4-212"><a href="#cb4-212" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-213"><a href="#cb4-213" aria-hidden="true" tabindex="-1"></a>      custom_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#336699"</span>, <span class="st">"#003366"</span>, <span class="st">"#4d4d4d"</span>, <span class="st">"#99ccff"</span>, <span class="st">"#1a1a1a"</span>)</span>
<span id="cb4-214"><a href="#cb4-214" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-215"><a href="#cb4-215" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Create pie chart plot</span></span>
<span id="cb4-216"><a href="#cb4-216" aria-hidden="true" tabindex="-1"></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(industry_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> Total_Injuries, <span class="at">fill =</span> industry)) <span class="sc">+</span></span>
<span id="cb4-217"><a href="#cb4-217" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb4-218"><a href="#cb4-218" aria-hidden="true" tabindex="-1"></a>        <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb4-219"><a href="#cb4-219" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(Percentage, <span class="st">"%"</span>)),</span>
<span id="cb4-220"><a href="#cb4-220" aria-hidden="true" tabindex="-1"></a>                  <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb4-221"><a href="#cb4-221" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(</span>
<span id="cb4-222"><a href="#cb4-222" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Top 5 Industries for Severe Injuries in"</span>, input<span class="sc">$</span>year_industry),</span>
<span id="cb4-223"><a href="#cb4-223" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"Industry"</span></span>
<span id="cb4-224"><a href="#cb4-224" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb4-225"><a href="#cb4-225" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb4-226"><a href="#cb4-226" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(</span>
<span id="cb4-227"><a href="#cb4-227" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb4-228"><a href="#cb4-228" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb4-229"><a href="#cb4-229" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb4-230"><a href="#cb4-230" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb4-231"><a href="#cb4-231" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors)</span>
<span id="cb4-232"><a href="#cb4-232" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-233"><a href="#cb4-233" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Save the plot as a PNG file</span></span>
<span id="cb4-234"><a href="#cb4-234" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggsave</span>(file, <span class="at">plot =</span> p, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb4-235"><a href="#cb4-235" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-236"><a href="#cb4-236" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-237"><a href="#cb4-237" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-238"><a href="#cb4-238" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Top States Analysis</span></span>
<span id="cb4-239"><a href="#cb4-239" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-240"><a href="#cb4-240" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Render a horizontal bar plot showing the top 5 states with the highest total injuries</span></span>
<span id="cb4-241"><a href="#cb4-241" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>top_states_plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb4-242"><a href="#cb4-242" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Summarize the data to get the top 5 states with the highest total injuries for the selected year</span></span>
<span id="cb4-243"><a href="#cb4-243" aria-hidden="true" tabindex="-1"></a>    top_states <span class="ot">&lt;-</span> severe_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-244"><a href="#cb4-244" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> input<span class="sc">$</span>year_state) <span class="sc">|&gt;</span></span>
<span id="cb4-245"><a href="#cb4-245" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb4-246"><a href="#cb4-246" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">Total_Injuries =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-247"><a href="#cb4-247" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(Total_Injuries)) <span class="sc">|&gt;</span></span>
<span id="cb4-248"><a href="#cb4-248" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-249"><a href="#cb4-249" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">state =</span> stringr<span class="sc">::</span><span class="fu">str_to_title</span>(state)) <span class="co"># Capitalize the first letter of each state</span></span>
<span id="cb4-250"><a href="#cb4-250" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-251"><a href="#cb4-251" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a horizontal bar plot of the top 5 states with the highest total injuries</span></span>
<span id="cb4-252"><a href="#cb4-252" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(top_states, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(state, Total_Injuries), <span class="at">y =</span> Total_Injuries, <span class="at">fill =</span> state)) <span class="sc">+</span></span>
<span id="cb4-253"><a href="#cb4-253" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_col</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb4-254"><a href="#cb4-254" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb4-255"><a href="#cb4-255" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb4-256"><a href="#cb4-256" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Top 5 States by Total Injuries in"</span>, input<span class="sc">$</span>year_state),</span>
<span id="cb4-257"><a href="#cb4-257" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"State"</span>,</span>
<span id="cb4-258"><a href="#cb4-258" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Total Injuries"</span></span>
<span id="cb4-259"><a href="#cb4-259" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-260"><a href="#cb4-260" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-261"><a href="#cb4-261" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb4-262"><a href="#cb4-262" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb4-263"><a href="#cb4-263" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-264"><a href="#cb4-264" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb4-265"><a href="#cb4-265" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb4-266"><a href="#cb4-266" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-267"><a href="#cb4-267" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-268"><a href="#cb4-268" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb4-269"><a href="#cb4-269" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-270"><a href="#cb4-270" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#336699"</span>, <span class="st">"#003366"</span>, <span class="st">"#4d4d4d"</span>, <span class="st">"#99ccff"</span>, <span class="st">"#1a1a1a"</span>))</span>
<span id="cb4-271"><a href="#cb4-271" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-272"><a href="#cb4-272" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-273"><a href="#cb4-273" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Render a horizontal bar plot showing total amputations and hospitalizations by state</span></span>
<span id="cb4-274"><a href="#cb4-274" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>top_states_amputation_hospitalization <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb4-275"><a href="#cb4-275" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Summarize data for total amputations and hospitalizations by state for the selected year</span></span>
<span id="cb4-276"><a href="#cb4-276" aria-hidden="true" tabindex="-1"></a>    states_amputation_hospitalization <span class="ot">&lt;-</span> severe_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-277"><a href="#cb4-277" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> input<span class="sc">$</span>year_state) <span class="sc">|&gt;</span></span>
<span id="cb4-278"><a href="#cb4-278" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb4-279"><a href="#cb4-279" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(</span>
<span id="cb4-280"><a href="#cb4-280" aria-hidden="true" tabindex="-1"></a>        <span class="at">Total_Amputations =</span> <span class="fu">sum</span>(amputation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-281"><a href="#cb4-281" aria-hidden="true" tabindex="-1"></a>        <span class="at">Total_Hospitalizations =</span> <span class="fu">sum</span>(hospitalization <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-282"><a href="#cb4-282" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb4-283"><a href="#cb4-283" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(Total_Hospitalizations)) <span class="sc">|&gt;</span></span>
<span id="cb4-284"><a href="#cb4-284" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-285"><a href="#cb4-285" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">state =</span> stringr<span class="sc">::</span><span class="fu">str_to_title</span>(state))</span>
<span id="cb4-286"><a href="#cb4-286" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-287"><a href="#cb4-287" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reshape the data to long format for plotting</span></span>
<span id="cb4-288"><a href="#cb4-288" aria-hidden="true" tabindex="-1"></a>    melted_data <span class="ot">&lt;-</span> states_amputation_hospitalization <span class="sc">|&gt;</span></span>
<span id="cb4-289"><a href="#cb4-289" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(Total_Amputations, Total_Hospitalizations), <span class="at">names_to =</span> <span class="st">"Type"</span>, <span class="at">values_to =</span> <span class="st">"Count"</span>)</span>
<span id="cb4-290"><a href="#cb4-290" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-291"><a href="#cb4-291" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a side-by-side bar plot comparing total amputations and hospitalizations across the top 5 states</span></span>
<span id="cb4-292"><a href="#cb4-292" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(melted_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(state, Count), <span class="at">y =</span> Count, <span class="at">fill =</span> Type)) <span class="sc">+</span></span>
<span id="cb4-293"><a href="#cb4-293" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb4-294"><a href="#cb4-294" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb4-295"><a href="#cb4-295" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb4-296"><a href="#cb4-296" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Top States for Amputations and Hospitalizations in"</span>, input<span class="sc">$</span>year_state),</span>
<span id="cb4-297"><a href="#cb4-297" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"State"</span>,</span>
<span id="cb4-298"><a href="#cb4-298" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb4-299"><a href="#cb4-299" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"Type"</span></span>
<span id="cb4-300"><a href="#cb4-300" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-301"><a href="#cb4-301" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-302"><a href="#cb4-302" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb4-303"><a href="#cb4-303" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb4-304"><a href="#cb4-304" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-305"><a href="#cb4-305" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb4-306"><a href="#cb4-306" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb4-307"><a href="#cb4-307" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-308"><a href="#cb4-308" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-309"><a href="#cb4-309" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb4-310"><a href="#cb4-310" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-311"><a href="#cb4-311" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb4-312"><a href="#cb4-312" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Total_Amputations"</span> <span class="ot">=</span> <span class="st">"#1f77b4"</span>,</span>
<span id="cb4-313"><a href="#cb4-313" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Total_Hospitalizations"</span> <span class="ot">=</span> <span class="st">"#595959"</span></span>
<span id="cb4-314"><a href="#cb4-314" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb4-315"><a href="#cb4-315" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-316"><a href="#cb4-316" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-317"><a href="#cb4-317" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Render a table for total injuries, amputations, and hospitalizations by state</span></span>
<span id="cb4-318"><a href="#cb4-318" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>state_table <span class="ot">&lt;-</span> <span class="fu">renderTable</span>({</span>
<span id="cb4-319"><a href="#cb4-319" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Summarize data for total injuries, amputations, and hospitalizations by state for the selected year</span></span>
<span id="cb4-320"><a href="#cb4-320" aria-hidden="true" tabindex="-1"></a>    states_table <span class="ot">&lt;-</span> severe_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-321"><a href="#cb4-321" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> input<span class="sc">$</span>year_state) <span class="sc">|&gt;</span></span>
<span id="cb4-322"><a href="#cb4-322" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb4-323"><a href="#cb4-323" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(</span>
<span id="cb4-324"><a href="#cb4-324" aria-hidden="true" tabindex="-1"></a>        <span class="at">Total_Injuries =</span> <span class="fu">n</span>(),</span>
<span id="cb4-325"><a href="#cb4-325" aria-hidden="true" tabindex="-1"></a>        <span class="at">Total_Amputations =</span> <span class="fu">sum</span>(amputation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-326"><a href="#cb4-326" aria-hidden="true" tabindex="-1"></a>        <span class="at">Total_Hospitalizations =</span> <span class="fu">sum</span>(hospitalization <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-327"><a href="#cb4-327" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb4-328"><a href="#cb4-328" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(Total_Injuries)) <span class="sc">|&gt;</span></span>
<span id="cb4-329"><a href="#cb4-329" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">state =</span> stringr<span class="sc">::</span><span class="fu">str_to_title</span>(state)) <span class="sc">|&gt;</span></span>
<span id="cb4-330"><a href="#cb4-330" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(</span>
<span id="cb4-331"><a href="#cb4-331" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">State</span><span class="st">`</span> <span class="ot">=</span> state,</span>
<span id="cb4-332"><a href="#cb4-332" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Total Injuries</span><span class="st">`</span> <span class="ot">=</span> Total_Injuries,</span>
<span id="cb4-333"><a href="#cb4-333" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Total Amputations</span><span class="st">`</span> <span class="ot">=</span> Total_Amputations,</span>
<span id="cb4-334"><a href="#cb4-334" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Total Hospitalizations</span><span class="st">`</span> <span class="ot">=</span> Total_Hospitalizations</span>
<span id="cb4-335"><a href="#cb4-335" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-336"><a href="#cb4-336" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-337"><a href="#cb4-337" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Display the summarized data as a table</span></span>
<span id="cb4-338"><a href="#cb4-338" aria-hidden="true" tabindex="-1"></a>    states_table</span>
<span id="cb4-339"><a href="#cb4-339" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-340"><a href="#cb4-340" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-341"><a href="#cb4-341" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Body Part Analysis</span></span>
<span id="cb4-342"><a href="#cb4-342" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-343"><a href="#cb4-343" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Plot the top 5 body parts with the most injuries for the selected year and industry (if specified)</span></span>
<span id="cb4-344"><a href="#cb4-344" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>body_part_pie_chart <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb4-345"><a href="#cb4-345" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data based on selected year and industry, then group by body part</span></span>
<span id="cb4-346"><a href="#cb4-346" aria-hidden="true" tabindex="-1"></a>    body_part_data <span class="ot">&lt;-</span> severe_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-347"><a href="#cb4-347" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(</span>
<span id="cb4-348"><a href="#cb4-348" aria-hidden="true" tabindex="-1"></a>        year <span class="sc">==</span> input<span class="sc">$</span>year_body_part,</span>
<span id="cb4-349"><a href="#cb4-349" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (input<span class="sc">$</span>industry_body_part <span class="sc">!=</span> <span class="st">"All Industries"</span>) industry <span class="sc">==</span> input<span class="sc">$</span>industry_body_part <span class="cf">else</span> <span class="cn">TRUE</span></span>
<span id="cb4-350"><a href="#cb4-350" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb4-351"><a href="#cb4-351" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(body_part) <span class="sc">|&gt;</span></span>
<span id="cb4-352"><a href="#cb4-352" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">Total =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-353"><a href="#cb4-353" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(Total)) <span class="sc">|&gt;</span></span>
<span id="cb4-354"><a href="#cb4-354" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Percentage =</span> <span class="fu">round</span>((Total <span class="sc">/</span> <span class="fu">sum</span>(Total)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-355"><a href="#cb4-355" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb4-356"><a href="#cb4-356" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-357"><a href="#cb4-357" aria-hidden="true" tabindex="-1"></a>    custom_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#336699"</span>, <span class="st">"#003366"</span>, <span class="st">"#4d4d4d"</span>, <span class="st">"#99ccff"</span>, <span class="st">"#1a1a1a"</span>)</span>
<span id="cb4-358"><a href="#cb4-358" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-359"><a href="#cb4-359" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a pie chart displaying the top 5 body parts and their respective percentages</span></span>
<span id="cb4-360"><a href="#cb4-360" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(body_part_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> Total, <span class="at">fill =</span> body_part)) <span class="sc">+</span></span>
<span id="cb4-361"><a href="#cb4-361" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb4-362"><a href="#cb4-362" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb4-363"><a href="#cb4-363" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(Percentage, <span class="st">"%"</span>)),</span>
<span id="cb4-364"><a href="#cb4-364" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb4-365"><a href="#cb4-365" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb4-366"><a href="#cb4-366" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Top 5 Body Parts in"</span>, input<span class="sc">$</span>year_body_part,</span>
<span id="cb4-367"><a href="#cb4-367" aria-hidden="true" tabindex="-1"></a>                      <span class="cf">if</span> (input<span class="sc">$</span>industry_body_part <span class="sc">!=</span> <span class="st">"All Industries"</span>) <span class="fu">paste</span>(<span class="st">"for"</span>, input<span class="sc">$</span>industry_body_part) <span class="cf">else</span> <span class="st">""</span>),</span>
<span id="cb4-368"><a href="#cb4-368" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"Body Part"</span></span>
<span id="cb4-369"><a href="#cb4-369" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-370"><a href="#cb4-370" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb4-371"><a href="#cb4-371" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb4-372"><a href="#cb4-372" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb4-373"><a href="#cb4-373" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb4-374"><a href="#cb4-374" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb4-375"><a href="#cb4-375" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-376"><a href="#cb4-376" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors)</span>
<span id="cb4-377"><a href="#cb4-377" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-378"><a href="#cb4-378" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-379"><a href="#cb4-379" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create and display a table showing the total injuries and percentage for the top 5 body parts</span></span>
<span id="cb4-380"><a href="#cb4-380" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>body_part_table <span class="ot">&lt;-</span> <span class="fu">renderTable</span>({</span>
<span id="cb4-381"><a href="#cb4-381" aria-hidden="true" tabindex="-1"></a>    body_part_data <span class="ot">&lt;-</span> severe_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-382"><a href="#cb4-382" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(</span>
<span id="cb4-383"><a href="#cb4-383" aria-hidden="true" tabindex="-1"></a>        year <span class="sc">==</span> input<span class="sc">$</span>year_body_part,</span>
<span id="cb4-384"><a href="#cb4-384" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (input<span class="sc">$</span>industry_body_part <span class="sc">!=</span> <span class="st">"All Industries"</span>) industry <span class="sc">==</span> input<span class="sc">$</span>industry_body_part <span class="cf">else</span> <span class="cn">TRUE</span></span>
<span id="cb4-385"><a href="#cb4-385" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb4-386"><a href="#cb4-386" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(body_part) <span class="sc">|&gt;</span></span>
<span id="cb4-387"><a href="#cb4-387" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">Total =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-388"><a href="#cb4-388" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(Total)) <span class="sc">|&gt;</span></span>
<span id="cb4-389"><a href="#cb4-389" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Percentage =</span> <span class="fu">round</span>((Total <span class="sc">/</span> <span class="fu">sum</span>(Total)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-390"><a href="#cb4-390" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(</span>
<span id="cb4-391"><a href="#cb4-391" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Body Part</span><span class="st">`</span> <span class="ot">=</span> body_part,</span>
<span id="cb4-392"><a href="#cb4-392" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Total Injuries</span><span class="st">`</span> <span class="ot">=</span> Total,</span>
<span id="cb4-393"><a href="#cb4-393" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Percentage (%)</span><span class="st">`</span> <span class="ot">=</span> Percentage</span>
<span id="cb4-394"><a href="#cb4-394" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-395"><a href="#cb4-395" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-396"><a href="#cb4-396" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the summarized data as a table</span></span>
<span id="cb4-397"><a href="#cb4-397" aria-hidden="true" tabindex="-1"></a>    body_part_data</span>
<span id="cb4-398"><a href="#cb4-398" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-399"><a href="#cb4-399" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-400"><a href="#cb4-400" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Download the body part pie chart as a PNG file</span></span>
<span id="cb4-401"><a href="#cb4-401" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>download_body_part_plot <span class="ot">&lt;-</span> <span class="fu">downloadHandler</span>(</span>
<span id="cb4-402"><a href="#cb4-402" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="cf">function</span>() {</span>
<span id="cb4-403"><a href="#cb4-403" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(<span class="st">"body_part_pie_chart_"</span>, <span class="fu">Sys.time</span>(), <span class="st">".png"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb4-404"><a href="#cb4-404" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb4-405"><a href="#cb4-405" aria-hidden="true" tabindex="-1"></a>    <span class="at">content =</span> <span class="cf">function</span>(file) {</span>
<span id="cb4-406"><a href="#cb4-406" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Filter and summarize the data for the pie chart</span></span>
<span id="cb4-407"><a href="#cb4-407" aria-hidden="true" tabindex="-1"></a>      body_part_data <span class="ot">&lt;-</span> severe_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-408"><a href="#cb4-408" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(</span>
<span id="cb4-409"><a href="#cb4-409" aria-hidden="true" tabindex="-1"></a>          year <span class="sc">==</span> input<span class="sc">$</span>year_body_part,</span>
<span id="cb4-410"><a href="#cb4-410" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (input<span class="sc">$</span>industry_body_part <span class="sc">!=</span> <span class="st">"All Industries"</span>) industry <span class="sc">==</span> input<span class="sc">$</span>industry_body_part <span class="cf">else</span> <span class="cn">TRUE</span></span>
<span id="cb4-411"><a href="#cb4-411" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb4-412"><a href="#cb4-412" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(body_part) <span class="sc">|&gt;</span></span>
<span id="cb4-413"><a href="#cb4-413" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">Total =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-414"><a href="#cb4-414" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(<span class="fu">desc</span>(Total)) <span class="sc">|&gt;</span></span>
<span id="cb4-415"><a href="#cb4-415" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">Percentage =</span> <span class="fu">round</span>((Total <span class="sc">/</span> <span class="fu">sum</span>(Total)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-416"><a href="#cb4-416" aria-hidden="true" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb4-417"><a href="#cb4-417" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-418"><a href="#cb4-418" aria-hidden="true" tabindex="-1"></a>      custom_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#336699"</span>, <span class="st">"#003366"</span>, <span class="st">"#4d4d4d"</span>, <span class="st">"#99ccff"</span>, <span class="st">"#1a1a1a"</span>)</span>
<span id="cb4-419"><a href="#cb4-419" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-420"><a href="#cb4-420" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Create the pie chart plot</span></span>
<span id="cb4-421"><a href="#cb4-421" aria-hidden="true" tabindex="-1"></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(body_part_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> Total, <span class="at">fill =</span> body_part)) <span class="sc">+</span></span>
<span id="cb4-422"><a href="#cb4-422" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb4-423"><a href="#cb4-423" aria-hidden="true" tabindex="-1"></a>        <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb4-424"><a href="#cb4-424" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(Total, <span class="st">" ("</span>, Percentage, <span class="st">"%)"</span>)),</span>
<span id="cb4-425"><a href="#cb4-425" aria-hidden="true" tabindex="-1"></a>                  <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb4-426"><a href="#cb4-426" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(</span>
<span id="cb4-427"><a href="#cb4-427" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Top 5 Body Parts in"</span>, input<span class="sc">$</span>year_body_part,</span>
<span id="cb4-428"><a href="#cb4-428" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> (input<span class="sc">$</span>industry_body_part <span class="sc">!=</span> <span class="st">"All Industries"</span>) <span class="fu">paste</span>(<span class="st">"for"</span>, input<span class="sc">$</span>industry_body_part) <span class="cf">else</span> <span class="st">""</span>),</span>
<span id="cb4-429"><a href="#cb4-429" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"Body Part"</span></span>
<span id="cb4-430"><a href="#cb4-430" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb4-431"><a href="#cb4-431" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb4-432"><a href="#cb4-432" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(</span>
<span id="cb4-433"><a href="#cb4-433" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb4-434"><a href="#cb4-434" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb4-435"><a href="#cb4-435" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb4-436"><a href="#cb4-436" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb4-437"><a href="#cb4-437" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors)</span>
<span id="cb4-438"><a href="#cb4-438" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-439"><a href="#cb4-439" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Save the plot as a PNG file</span></span>
<span id="cb4-440"><a href="#cb4-440" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggsave</span>(file, <span class="at">plot =</span> p, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb4-441"><a href="#cb4-441" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-442"><a href="#cb4-442" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-443"><a href="#cb4-443" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-444"><a href="#cb4-444" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Event Categories Analysis</span></span>
<span id="cb4-445"><a href="#cb4-445" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-446"><a href="#cb4-446" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot the top 5 event categories with the most injuries for the selected year and industry (if specified)</span></span>
<span id="cb4-447"><a href="#cb4-447" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>event_category_pie_chart <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb4-448"><a href="#cb4-448" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data based on selected year and industry, then group by event category</span></span>
<span id="cb4-449"><a href="#cb4-449" aria-hidden="true" tabindex="-1"></a>    event_data <span class="ot">&lt;-</span> severe_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-450"><a href="#cb4-450" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(</span>
<span id="cb4-451"><a href="#cb4-451" aria-hidden="true" tabindex="-1"></a>        year <span class="sc">==</span> input<span class="sc">$</span>year_event,</span>
<span id="cb4-452"><a href="#cb4-452" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (input<span class="sc">$</span>industry_event <span class="sc">!=</span> <span class="st">"All Industries"</span>) industry <span class="sc">==</span> input<span class="sc">$</span>industry_event <span class="cf">else</span> <span class="cn">TRUE</span></span>
<span id="cb4-453"><a href="#cb4-453" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb4-454"><a href="#cb4-454" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(event_category) <span class="sc">|&gt;</span></span>
<span id="cb4-455"><a href="#cb4-455" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">Total =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-456"><a href="#cb4-456" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(Total)) <span class="sc">|&gt;</span></span>
<span id="cb4-457"><a href="#cb4-457" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Percentage =</span> <span class="fu">round</span>((Total <span class="sc">/</span> <span class="fu">sum</span>(Total)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-458"><a href="#cb4-458" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb4-459"><a href="#cb4-459" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-460"><a href="#cb4-460" aria-hidden="true" tabindex="-1"></a>    custom_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#336699"</span>, <span class="st">"#003366"</span>, <span class="st">"#4d4d4d"</span>, <span class="st">"#99ccff"</span>, <span class="st">"#1a1a1a"</span>)</span>
<span id="cb4-461"><a href="#cb4-461" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-462"><a href="#cb4-462" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a pie chart displaying the top 5 event categories and their respective percentages</span></span>
<span id="cb4-463"><a href="#cb4-463" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(event_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> Total, <span class="at">fill =</span> event_category)) <span class="sc">+</span></span>
<span id="cb4-464"><a href="#cb4-464" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb4-465"><a href="#cb4-465" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb4-466"><a href="#cb4-466" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(Percentage, <span class="st">"%"</span>)),</span>
<span id="cb4-467"><a href="#cb4-467" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb4-468"><a href="#cb4-468" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb4-469"><a href="#cb4-469" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Top 5 Event Categories in"</span>, input<span class="sc">$</span>year_event,</span>
<span id="cb4-470"><a href="#cb4-470" aria-hidden="true" tabindex="-1"></a>                      <span class="cf">if</span> (input<span class="sc">$</span>industry_event <span class="sc">!=</span> <span class="st">"All Industries"</span>) <span class="fu">paste</span>(<span class="st">"for"</span>, input<span class="sc">$</span>industry_event) <span class="cf">else</span> <span class="st">""</span>),</span>
<span id="cb4-471"><a href="#cb4-471" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"Event Category"</span></span>
<span id="cb4-472"><a href="#cb4-472" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-473"><a href="#cb4-473" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb4-474"><a href="#cb4-474" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb4-475"><a href="#cb4-475" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb4-476"><a href="#cb4-476" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb4-477"><a href="#cb4-477" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb4-478"><a href="#cb4-478" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-479"><a href="#cb4-479" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors)</span>
<span id="cb4-480"><a href="#cb4-480" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-481"><a href="#cb4-481" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-482"><a href="#cb4-482" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create and display a table showing the total injuries and percentage for the top 5 event categories</span></span>
<span id="cb4-483"><a href="#cb4-483" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>event_category_table <span class="ot">&lt;-</span> <span class="fu">renderTable</span>({</span>
<span id="cb4-484"><a href="#cb4-484" aria-hidden="true" tabindex="-1"></a>    event_data <span class="ot">&lt;-</span> severe_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-485"><a href="#cb4-485" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(</span>
<span id="cb4-486"><a href="#cb4-486" aria-hidden="true" tabindex="-1"></a>        year <span class="sc">==</span> input<span class="sc">$</span>year_event,</span>
<span id="cb4-487"><a href="#cb4-487" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (input<span class="sc">$</span>industry_event <span class="sc">!=</span> <span class="st">"All Industries"</span>) industry <span class="sc">==</span> input<span class="sc">$</span>industry_event <span class="cf">else</span> <span class="cn">TRUE</span></span>
<span id="cb4-488"><a href="#cb4-488" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb4-489"><a href="#cb4-489" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(event_category) <span class="sc">|&gt;</span></span>
<span id="cb4-490"><a href="#cb4-490" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">Total =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-491"><a href="#cb4-491" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(Total)) <span class="sc">|&gt;</span></span>
<span id="cb4-492"><a href="#cb4-492" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Percentage =</span> <span class="fu">round</span>((Total <span class="sc">/</span> <span class="fu">sum</span>(Total)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-493"><a href="#cb4-493" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(</span>
<span id="cb4-494"><a href="#cb4-494" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Event Category</span><span class="st">`</span> <span class="ot">=</span> event_category,</span>
<span id="cb4-495"><a href="#cb4-495" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Total Injuries</span><span class="st">`</span> <span class="ot">=</span> Total,</span>
<span id="cb4-496"><a href="#cb4-496" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Percentage (%)</span><span class="st">`</span> <span class="ot">=</span> Percentage</span>
<span id="cb4-497"><a href="#cb4-497" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-498"><a href="#cb4-498" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-499"><a href="#cb4-499" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the summarized data as a table</span></span>
<span id="cb4-500"><a href="#cb4-500" aria-hidden="true" tabindex="-1"></a>    event_data</span>
<span id="cb4-501"><a href="#cb4-501" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-502"><a href="#cb4-502" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-503"><a href="#cb4-503" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Download the event category pie chart as a PNG file</span></span>
<span id="cb4-504"><a href="#cb4-504" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>download_event_category_plot <span class="ot">&lt;-</span> <span class="fu">downloadHandler</span>(</span>
<span id="cb4-505"><a href="#cb4-505" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="cf">function</span>() {</span>
<span id="cb4-506"><a href="#cb4-506" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(<span class="st">"event_category_pie_chart_"</span>, <span class="fu">Sys.time</span>(), <span class="st">".png"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb4-507"><a href="#cb4-507" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb4-508"><a href="#cb4-508" aria-hidden="true" tabindex="-1"></a>    <span class="at">content =</span> <span class="cf">function</span>(file) {</span>
<span id="cb4-509"><a href="#cb4-509" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Filter and summarize the data for the pie chart</span></span>
<span id="cb4-510"><a href="#cb4-510" aria-hidden="true" tabindex="-1"></a>      event_data <span class="ot">&lt;-</span> severe_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-511"><a href="#cb4-511" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(</span>
<span id="cb4-512"><a href="#cb4-512" aria-hidden="true" tabindex="-1"></a>          year <span class="sc">==</span> input<span class="sc">$</span>year_event,</span>
<span id="cb4-513"><a href="#cb4-513" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (input<span class="sc">$</span>industry_event <span class="sc">!=</span> <span class="st">"All Industries"</span>) industry <span class="sc">==</span> input<span class="sc">$</span>industry_event <span class="cf">else</span> <span class="cn">TRUE</span></span>
<span id="cb4-514"><a href="#cb4-514" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb4-515"><a href="#cb4-515" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(event_category) <span class="sc">|&gt;</span></span>
<span id="cb4-516"><a href="#cb4-516" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">Total =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-517"><a href="#cb4-517" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(<span class="fu">desc</span>(Total)) <span class="sc">|&gt;</span></span>
<span id="cb4-518"><a href="#cb4-518" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">Percentage =</span> <span class="fu">round</span>((Total <span class="sc">/</span> <span class="fu">sum</span>(Total)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-519"><a href="#cb4-519" aria-hidden="true" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb4-520"><a href="#cb4-520" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-521"><a href="#cb4-521" aria-hidden="true" tabindex="-1"></a>      custom_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#336699"</span>, <span class="st">"#003366"</span>, <span class="st">"#4d4d4d"</span>, <span class="st">"#99ccff"</span>, <span class="st">"#1a1a1a"</span>)</span>
<span id="cb4-522"><a href="#cb4-522" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-523"><a href="#cb4-523" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Create the pie chart plot</span></span>
<span id="cb4-524"><a href="#cb4-524" aria-hidden="true" tabindex="-1"></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(event_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> Total, <span class="at">fill =</span> event_category)) <span class="sc">+</span></span>
<span id="cb4-525"><a href="#cb4-525" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb4-526"><a href="#cb4-526" aria-hidden="true" tabindex="-1"></a>        <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb4-527"><a href="#cb4-527" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(Total, <span class="st">" ("</span>, Percentage, <span class="st">"%)"</span>)),</span>
<span id="cb4-528"><a href="#cb4-528" aria-hidden="true" tabindex="-1"></a>                  <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb4-529"><a href="#cb4-529" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(</span>
<span id="cb4-530"><a href="#cb4-530" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Top 5 Event Categories in"</span>, input<span class="sc">$</span>year_event,</span>
<span id="cb4-531"><a href="#cb4-531" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> (input<span class="sc">$</span>industry_event <span class="sc">!=</span> <span class="st">"All Industries"</span>) <span class="fu">paste</span>(<span class="st">"for"</span>, input<span class="sc">$</span>industry_event) <span class="cf">else</span> <span class="st">""</span>),</span>
<span id="cb4-532"><a href="#cb4-532" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"Event Category"</span></span>
<span id="cb4-533"><a href="#cb4-533" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb4-534"><a href="#cb4-534" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb4-535"><a href="#cb4-535" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(</span>
<span id="cb4-536"><a href="#cb4-536" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb4-537"><a href="#cb4-537" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb4-538"><a href="#cb4-538" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb4-539"><a href="#cb4-539" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb4-540"><a href="#cb4-540" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors)</span>
<span id="cb4-541"><a href="#cb4-541" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-542"><a href="#cb4-542" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Save the plot as a PNG file</span></span>
<span id="cb4-543"><a href="#cb4-543" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggsave</span>(file, <span class="at">plot =</span> p, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb4-544"><a href="#cb4-544" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-545"><a href="#cb4-545" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-546"><a href="#cb4-546" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-547"><a href="#cb4-547" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Source Categories Analysis</span></span>
<span id="cb4-548"><a href="#cb4-548" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-549"><a href="#cb4-549" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot the top 5 source categories with the most injuries for the selected year and industry (if specified)</span></span>
<span id="cb4-550"><a href="#cb4-550" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>source_category_pie_chart <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb4-551"><a href="#cb4-551" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data based on selected year and industry, then group by source category</span></span>
<span id="cb4-552"><a href="#cb4-552" aria-hidden="true" tabindex="-1"></a>    source_data <span class="ot">&lt;-</span> severe_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-553"><a href="#cb4-553" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(</span>
<span id="cb4-554"><a href="#cb4-554" aria-hidden="true" tabindex="-1"></a>        year <span class="sc">==</span> input<span class="sc">$</span>year_source,</span>
<span id="cb4-555"><a href="#cb4-555" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (input<span class="sc">$</span>industry_source <span class="sc">!=</span> <span class="st">"All Industries"</span>) industry <span class="sc">==</span> input<span class="sc">$</span>industry_source <span class="cf">else</span> <span class="cn">TRUE</span></span>
<span id="cb4-556"><a href="#cb4-556" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb4-557"><a href="#cb4-557" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(source_category) <span class="sc">|&gt;</span></span>
<span id="cb4-558"><a href="#cb4-558" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">Total =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-559"><a href="#cb4-559" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(Total)) <span class="sc">|&gt;</span></span>
<span id="cb4-560"><a href="#cb4-560" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Percentage =</span> <span class="fu">round</span>((Total <span class="sc">/</span> <span class="fu">sum</span>(Total)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-561"><a href="#cb4-561" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb4-562"><a href="#cb4-562" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-563"><a href="#cb4-563" aria-hidden="true" tabindex="-1"></a>    custom_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#336699"</span>, <span class="st">"#003366"</span>, <span class="st">"#4d4d4d"</span>, <span class="st">"#99ccff"</span>, <span class="st">"#1a1a1a"</span>)</span>
<span id="cb4-564"><a href="#cb4-564" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-565"><a href="#cb4-565" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a pie chart displaying the top 5 source categories and their respective percentages</span></span>
<span id="cb4-566"><a href="#cb4-566" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(source_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> Total, <span class="at">fill =</span> source_category)) <span class="sc">+</span></span>
<span id="cb4-567"><a href="#cb4-567" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb4-568"><a href="#cb4-568" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb4-569"><a href="#cb4-569" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(Percentage, <span class="st">"%"</span>)),</span>
<span id="cb4-570"><a href="#cb4-570" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb4-571"><a href="#cb4-571" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb4-572"><a href="#cb4-572" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Top 5 Source Categories in"</span>, input<span class="sc">$</span>year_source,</span>
<span id="cb4-573"><a href="#cb4-573" aria-hidden="true" tabindex="-1"></a>                      <span class="cf">if</span> (input<span class="sc">$</span>industry_source <span class="sc">!=</span> <span class="st">"All Industries"</span>) <span class="fu">paste</span>(<span class="st">"for"</span>, input<span class="sc">$</span>industry_source) <span class="cf">else</span> <span class="st">""</span>),</span>
<span id="cb4-574"><a href="#cb4-574" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"Source Category"</span></span>
<span id="cb4-575"><a href="#cb4-575" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-576"><a href="#cb4-576" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb4-577"><a href="#cb4-577" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb4-578"><a href="#cb4-578" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb4-579"><a href="#cb4-579" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb4-580"><a href="#cb4-580" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb4-581"><a href="#cb4-581" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-582"><a href="#cb4-582" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors)</span>
<span id="cb4-583"><a href="#cb4-583" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-584"><a href="#cb4-584" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-585"><a href="#cb4-585" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create and display a table showing the total injuries and percentage for the top 5 source categories</span></span>
<span id="cb4-586"><a href="#cb4-586" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>source_category_table <span class="ot">&lt;-</span> <span class="fu">renderTable</span>({</span>
<span id="cb4-587"><a href="#cb4-587" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data based on selected year and industry, then group by source category</span></span>
<span id="cb4-588"><a href="#cb4-588" aria-hidden="true" tabindex="-1"></a>    source_data <span class="ot">&lt;-</span> severe_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-589"><a href="#cb4-589" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(</span>
<span id="cb4-590"><a href="#cb4-590" aria-hidden="true" tabindex="-1"></a>        year <span class="sc">==</span> input<span class="sc">$</span>year_source,</span>
<span id="cb4-591"><a href="#cb4-591" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (input<span class="sc">$</span>industry_source <span class="sc">!=</span> <span class="st">"All Industries"</span>) industry <span class="sc">==</span> input<span class="sc">$</span>industry_source <span class="cf">else</span> <span class="cn">TRUE</span></span>
<span id="cb4-592"><a href="#cb4-592" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb4-593"><a href="#cb4-593" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(source_category) <span class="sc">|&gt;</span></span>
<span id="cb4-594"><a href="#cb4-594" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">Total =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-595"><a href="#cb4-595" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(Total)) <span class="sc">|&gt;</span></span>
<span id="cb4-596"><a href="#cb4-596" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Percentage =</span> <span class="fu">round</span>((Total <span class="sc">/</span> <span class="fu">sum</span>(Total)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-597"><a href="#cb4-597" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(</span>
<span id="cb4-598"><a href="#cb4-598" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Source Category</span><span class="st">`</span> <span class="ot">=</span> source_category,</span>
<span id="cb4-599"><a href="#cb4-599" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Total Injuries</span><span class="st">`</span> <span class="ot">=</span> Total,</span>
<span id="cb4-600"><a href="#cb4-600" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Percentage (%)</span><span class="st">`</span> <span class="ot">=</span> Percentage</span>
<span id="cb4-601"><a href="#cb4-601" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-602"><a href="#cb4-602" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-603"><a href="#cb4-603" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the summarized data as a table</span></span>
<span id="cb4-604"><a href="#cb4-604" aria-hidden="true" tabindex="-1"></a>    source_data</span>
<span id="cb4-605"><a href="#cb4-605" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-606"><a href="#cb4-606" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-607"><a href="#cb4-607" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Download the source category pie chart as a PNG file</span></span>
<span id="cb4-608"><a href="#cb4-608" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>download_source_category_plot <span class="ot">&lt;-</span> <span class="fu">downloadHandler</span>(</span>
<span id="cb4-609"><a href="#cb4-609" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="cf">function</span>() {</span>
<span id="cb4-610"><a href="#cb4-610" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(<span class="st">"source_category_pie_chart_"</span>, <span class="fu">Sys.time</span>(), <span class="st">".png"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb4-611"><a href="#cb4-611" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb4-612"><a href="#cb4-612" aria-hidden="true" tabindex="-1"></a>    <span class="at">content =</span> <span class="cf">function</span>(file) {</span>
<span id="cb4-613"><a href="#cb4-613" aria-hidden="true" tabindex="-1"></a>      source_data <span class="ot">&lt;-</span> severe_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-614"><a href="#cb4-614" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(</span>
<span id="cb4-615"><a href="#cb4-615" aria-hidden="true" tabindex="-1"></a>          year <span class="sc">==</span> input<span class="sc">$</span>year_source,</span>
<span id="cb4-616"><a href="#cb4-616" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (input<span class="sc">$</span>industry_source <span class="sc">!=</span> <span class="st">"All Industries"</span>) industry <span class="sc">==</span> input<span class="sc">$</span>industry_source <span class="cf">else</span> <span class="cn">TRUE</span></span>
<span id="cb4-617"><a href="#cb4-617" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb4-618"><a href="#cb4-618" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(source_category) <span class="sc">|&gt;</span></span>
<span id="cb4-619"><a href="#cb4-619" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">Total =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-620"><a href="#cb4-620" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(<span class="fu">desc</span>(Total)) <span class="sc">|&gt;</span></span>
<span id="cb4-621"><a href="#cb4-621" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">Percentage =</span> <span class="fu">round</span>((Total <span class="sc">/</span> <span class="fu">sum</span>(Total)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-622"><a href="#cb4-622" aria-hidden="true" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb4-623"><a href="#cb4-623" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-624"><a href="#cb4-624" aria-hidden="true" tabindex="-1"></a>      custom_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#336699"</span>, <span class="st">"#003366"</span>, <span class="st">"#4d4d4d"</span>, <span class="st">"#99ccff"</span>, <span class="st">"#1a1a1a"</span>)</span>
<span id="cb4-625"><a href="#cb4-625" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-626"><a href="#cb4-626" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Create the pie chart plot</span></span>
<span id="cb4-627"><a href="#cb4-627" aria-hidden="true" tabindex="-1"></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(source_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> Total, <span class="at">fill =</span> source_category)) <span class="sc">+</span></span>
<span id="cb4-628"><a href="#cb4-628" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb4-629"><a href="#cb4-629" aria-hidden="true" tabindex="-1"></a>        <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb4-630"><a href="#cb4-630" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(Total, <span class="st">" ("</span>, Percentage, <span class="st">"%)"</span>)),</span>
<span id="cb4-631"><a href="#cb4-631" aria-hidden="true" tabindex="-1"></a>                  <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb4-632"><a href="#cb4-632" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(</span>
<span id="cb4-633"><a href="#cb4-633" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Top 5 Source Categories in"</span>, input<span class="sc">$</span>year_source,</span>
<span id="cb4-634"><a href="#cb4-634" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> (input<span class="sc">$</span>industry_source <span class="sc">!=</span> <span class="st">"All Industries"</span>) <span class="fu">paste</span>(<span class="st">"for"</span>, input<span class="sc">$</span>industry_source) <span class="cf">else</span> <span class="st">""</span>),</span>
<span id="cb4-635"><a href="#cb4-635" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"Source Category"</span></span>
<span id="cb4-636"><a href="#cb4-636" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb4-637"><a href="#cb4-637" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb4-638"><a href="#cb4-638" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(</span>
<span id="cb4-639"><a href="#cb4-639" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb4-640"><a href="#cb4-640" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb4-641"><a href="#cb4-641" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb4-642"><a href="#cb4-642" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb4-643"><a href="#cb4-643" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors)</span>
<span id="cb4-644"><a href="#cb4-644" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-645"><a href="#cb4-645" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Save the plot as a PNG file</span></span>
<span id="cb4-646"><a href="#cb4-646" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggsave</span>(file, <span class="at">plot =</span> p, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb4-647"><a href="#cb4-647" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-648"><a href="#cb4-648" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-649"><a href="#cb4-649" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-650"><a href="#cb4-650" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Trend Overview</span></span>
<span id="cb4-651"><a href="#cb4-651" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-652"><a href="#cb4-652" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot trend overview of injuries over years</span></span>
<span id="cb4-653"><a href="#cb4-653" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>line_plot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb4-654"><a href="#cb4-654" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data based on selected year and industry, then group by year</span></span>
<span id="cb4-655"><a href="#cb4-655" aria-hidden="true" tabindex="-1"></a>    trend_data <span class="ot">&lt;-</span> severe_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-656"><a href="#cb4-656" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="cf">if</span> (input<span class="sc">$</span>industry_trend <span class="sc">!=</span> <span class="st">"All Industries"</span>) industry <span class="sc">==</span> input<span class="sc">$</span>industry_trend <span class="cf">else</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-657"><a href="#cb4-657" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb4-658"><a href="#cb4-658" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(</span>
<span id="cb4-659"><a href="#cb4-659" aria-hidden="true" tabindex="-1"></a>        <span class="at">Total_Injuries =</span> <span class="fu">n</span>(),</span>
<span id="cb4-660"><a href="#cb4-660" aria-hidden="true" tabindex="-1"></a>        <span class="at">Total_Hospitalized =</span> <span class="fu">sum</span>(hospitalization <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-661"><a href="#cb4-661" aria-hidden="true" tabindex="-1"></a>        <span class="at">Total_Amputations =</span> <span class="fu">sum</span>(amputation <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-662"><a href="#cb4-662" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb4-663"><a href="#cb4-663" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(</span>
<span id="cb4-664"><a href="#cb4-664" aria-hidden="true" tabindex="-1"></a>        <span class="at">cols =</span> <span class="fu">c</span>(Total_Injuries, Total_Hospitalized, Total_Amputations), </span>
<span id="cb4-665"><a href="#cb4-665" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">"Metric"</span>, </span>
<span id="cb4-666"><a href="#cb4-666" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_to =</span> <span class="st">"Count"</span></span>
<span id="cb4-667"><a href="#cb4-667" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-668"><a href="#cb4-668" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-669"><a href="#cb4-669" aria-hidden="true" tabindex="-1"></a>    trend_data<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(trend_data<span class="sc">$</span>year)</span>
<span id="cb4-670"><a href="#cb4-670" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-671"><a href="#cb4-671" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a plot displaying the trend overview of injuries over the years</span></span>
<span id="cb4-672"><a href="#cb4-672" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(trend_data, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> Count, <span class="at">color =</span> Metric, <span class="at">group =</span> Metric)) <span class="sc">+</span></span>
<span id="cb4-673"><a href="#cb4-673" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb4-674"><a href="#cb4-674" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb4-675"><a href="#cb4-675" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb4-676"><a href="#cb4-676" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb4-677"><a href="#cb4-677" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Trend Over Years"</span>, </span>
<span id="cb4-678"><a href="#cb4-678" aria-hidden="true" tabindex="-1"></a>                      <span class="cf">if</span> (input<span class="sc">$</span>industry_trend <span class="sc">!=</span> <span class="st">"All Industries"</span>) <span class="fu">paste</span>(<span class="st">"for"</span>, input<span class="sc">$</span>industry_trend) <span class="cf">else</span> <span class="st">"for All Industries"</span>),</span>
<span id="cb4-679"><a href="#cb4-679" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb4-680"><a href="#cb4-680" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb4-681"><a href="#cb4-681" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"Metric"</span></span>
<span id="cb4-682"><a href="#cb4-682" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-683"><a href="#cb4-683" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb4-684"><a href="#cb4-684" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-685"><a href="#cb4-685" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb4-686"><a href="#cb4-686" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb4-687"><a href="#cb4-687" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb4-688"><a href="#cb4-688" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb4-689"><a href="#cb4-689" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb4-690"><a href="#cb4-690" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb4-691"><a href="#cb4-691" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-692"><a href="#cb4-692" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb4-693"><a href="#cb4-693" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Total_Injuries"</span> <span class="ot">=</span> <span class="st">"#336699"</span>,</span>
<span id="cb4-694"><a href="#cb4-694" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Total_Hospitalized"</span> <span class="ot">=</span> <span class="st">"#4d4d4d"</span>,</span>
<span id="cb4-695"><a href="#cb4-695" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Total_Amputations"</span> <span class="ot">=</span> <span class="st">"#003366"</span></span>
<span id="cb4-696"><a href="#cb4-696" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb4-697"><a href="#cb4-697" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-698"><a href="#cb4-698" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplotly</span>(p, <span class="at">tooltip =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"color"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-699"><a href="#cb4-699" aria-hidden="true" tabindex="-1"></a>      <span class="fu">config</span>(<span class="at">displayModeBar =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-700"><a href="#cb4-700" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-701"><a href="#cb4-701" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-702"><a href="#cb4-702" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Download the trend overview line plot as a PNG file</span></span>
<span id="cb4-703"><a href="#cb4-703" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>download_trend_plot <span class="ot">&lt;-</span> <span class="fu">downloadHandler</span>(</span>
<span id="cb4-704"><a href="#cb4-704" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="cf">function</span>() {</span>
<span id="cb4-705"><a href="#cb4-705" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Generate the file name with timestamp</span></span>
<span id="cb4-706"><a href="#cb4-706" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(<span class="st">"trend_overview_"</span>, <span class="fu">Sys.time</span>(), <span class="st">".png"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb4-707"><a href="#cb4-707" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb4-708"><a href="#cb4-708" aria-hidden="true" tabindex="-1"></a>    <span class="at">content =</span> <span class="cf">function</span>(file) {</span>
<span id="cb4-709"><a href="#cb4-709" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Filter and summarize the data for the line graph</span></span>
<span id="cb4-710"><a href="#cb4-710" aria-hidden="true" tabindex="-1"></a>      trend_data <span class="ot">&lt;-</span> severe_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-711"><a href="#cb4-711" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="cf">if</span> (input<span class="sc">$</span>industry_trend <span class="sc">!=</span> <span class="st">"All Industries"</span>) industry <span class="sc">==</span> input<span class="sc">$</span>industry_trend <span class="cf">else</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-712"><a href="#cb4-712" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb4-713"><a href="#cb4-713" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(</span>
<span id="cb4-714"><a href="#cb4-714" aria-hidden="true" tabindex="-1"></a>          <span class="at">Total_Injuries =</span> <span class="fu">n</span>(),</span>
<span id="cb4-715"><a href="#cb4-715" aria-hidden="true" tabindex="-1"></a>          <span class="at">Total_Hospitalized =</span> <span class="fu">sum</span>(hospitalization <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-716"><a href="#cb4-716" aria-hidden="true" tabindex="-1"></a>          <span class="at">Total_Amputations =</span> <span class="fu">sum</span>(amputation <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-717"><a href="#cb4-717" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb4-718"><a href="#cb4-718" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pivot_longer</span>(</span>
<span id="cb4-719"><a href="#cb4-719" aria-hidden="true" tabindex="-1"></a>          <span class="at">cols =</span> <span class="fu">c</span>(Total_Injuries, Total_Hospitalized, Total_Amputations), </span>
<span id="cb4-720"><a href="#cb4-720" aria-hidden="true" tabindex="-1"></a>          <span class="at">names_to =</span> <span class="st">"Metric"</span>, </span>
<span id="cb4-721"><a href="#cb4-721" aria-hidden="true" tabindex="-1"></a>          <span class="at">values_to =</span> <span class="st">"Count"</span></span>
<span id="cb4-722"><a href="#cb4-722" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-723"><a href="#cb4-723" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-724"><a href="#cb4-724" aria-hidden="true" tabindex="-1"></a>      trend_data<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(trend_data<span class="sc">$</span>year)</span>
<span id="cb4-725"><a href="#cb4-725" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-726"><a href="#cb4-726" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Create the line graph</span></span>
<span id="cb4-727"><a href="#cb4-727" aria-hidden="true" tabindex="-1"></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(trend_data, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> Count, <span class="at">color =</span> Metric, <span class="at">group =</span> Metric)) <span class="sc">+</span></span>
<span id="cb4-728"><a href="#cb4-728" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb4-729"><a href="#cb4-729" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb4-730"><a href="#cb4-730" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb4-731"><a href="#cb4-731" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(</span>
<span id="cb4-732"><a href="#cb4-732" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Trend Over Years"</span>, </span>
<span id="cb4-733"><a href="#cb4-733" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> (input<span class="sc">$</span>industry_trend <span class="sc">!=</span> <span class="st">"All Industries"</span>) <span class="fu">paste</span>(<span class="st">"for"</span>, input<span class="sc">$</span>industry_trend) <span class="cf">else</span> <span class="st">""</span>),</span>
<span id="cb4-734"><a href="#cb4-734" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb4-735"><a href="#cb4-735" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb4-736"><a href="#cb4-736" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"Metric"</span></span>
<span id="cb4-737"><a href="#cb4-737" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb4-738"><a href="#cb4-738" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(</span>
<span id="cb4-739"><a href="#cb4-739" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-740"><a href="#cb4-740" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb4-741"><a href="#cb4-741" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb4-742"><a href="#cb4-742" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb4-743"><a href="#cb4-743" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb4-744"><a href="#cb4-744" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb4-745"><a href="#cb4-745" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>) </span>
<span id="cb4-746"><a href="#cb4-746" aria-hidden="true" tabindex="-1"></a>        )<span class="sc">+</span></span>
<span id="cb4-747"><a href="#cb4-747" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb4-748"><a href="#cb4-748" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Total_Injuries"</span> <span class="ot">=</span> <span class="st">"#336699"</span>,</span>
<span id="cb4-749"><a href="#cb4-749" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Total_Hospitalized"</span> <span class="ot">=</span> <span class="st">"#4d4d4d"</span>,</span>
<span id="cb4-750"><a href="#cb4-750" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Total_Amputations"</span> <span class="ot">=</span> <span class="st">"#003366"</span></span>
<span id="cb4-751"><a href="#cb4-751" aria-hidden="true" tabindex="-1"></a>        ))</span>
<span id="cb4-752"><a href="#cb4-752" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-753"><a href="#cb4-753" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Save the plot as a PNG file</span></span>
<span id="cb4-754"><a href="#cb4-754" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggsave</span>(file, <span class="at">plot =</span> p, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb4-755"><a href="#cb4-755" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-756"><a href="#cb4-756" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-757"><a href="#cb4-757" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-758"><a href="#cb4-758" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Interactive Filters for Severe Injuries</span></span>
<span id="cb4-759"><a href="#cb4-759" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-760"><a href="#cb4-760" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reactive expression for filtering the data based on user inputs</span></span>
<span id="cb4-761"><a href="#cb4-761" aria-hidden="true" tabindex="-1"></a>  filtered_data <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb4-762"><a href="#cb4-762" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> severe_injuries_data</span>
<span id="cb4-763"><a href="#cb4-763" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-764"><a href="#cb4-764" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data by year</span></span>
<span id="cb4-765"><a href="#cb4-765" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> input<span class="sc">$</span>year_filter)</span>
<span id="cb4-766"><a href="#cb4-766" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-767"><a href="#cb4-767" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter by state if a specific state is selected</span></span>
<span id="cb4-768"><a href="#cb4-768" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>state_filter <span class="sc">!=</span> <span class="st">"All States"</span>) {</span>
<span id="cb4-769"><a href="#cb4-769" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(state <span class="sc">==</span> input<span class="sc">$</span>state_filter)</span>
<span id="cb4-770"><a href="#cb4-770" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-771"><a href="#cb4-771" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-772"><a href="#cb4-772" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter by industry if a specific industry is selected</span></span>
<span id="cb4-773"><a href="#cb4-773" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>industry_filter <span class="sc">!=</span> <span class="st">"All Industries"</span>) {</span>
<span id="cb4-774"><a href="#cb4-774" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(industry <span class="sc">==</span> input<span class="sc">$</span>industry_filter)</span>
<span id="cb4-775"><a href="#cb4-775" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-776"><a href="#cb4-776" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-777"><a href="#cb4-777" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter based on hospitalization status</span></span>
<span id="cb4-778"><a href="#cb4-778" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>hospitalized_filter <span class="sc">==</span> <span class="st">"Yes"</span>) {</span>
<span id="cb4-779"><a href="#cb4-779" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(hospitalization <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb4-780"><a href="#cb4-780" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb4-781"><a href="#cb4-781" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(hospitalization <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb4-782"><a href="#cb4-782" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-783"><a href="#cb4-783" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-784"><a href="#cb4-784" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter based on amputation status</span></span>
<span id="cb4-785"><a href="#cb4-785" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>amputation_filter <span class="sc">==</span> <span class="st">"Yes"</span>) {</span>
<span id="cb4-786"><a href="#cb4-786" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(amputation <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb4-787"><a href="#cb4-787" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb4-788"><a href="#cb4-788" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(amputation <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb4-789"><a href="#cb4-789" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-790"><a href="#cb4-790" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-791"><a href="#cb4-791" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter by nature of the injury if a specific category is selected</span></span>
<span id="cb4-792"><a href="#cb4-792" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>nature_filter <span class="sc">!=</span> <span class="st">"All"</span>) {</span>
<span id="cb4-793"><a href="#cb4-793" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(nature_category <span class="sc">==</span> input<span class="sc">$</span>nature_filter)</span>
<span id="cb4-794"><a href="#cb4-794" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-795"><a href="#cb4-795" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-796"><a href="#cb4-796" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter by affected body part if a specific category is selected</span></span>
<span id="cb4-797"><a href="#cb4-797" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>body_part_filter <span class="sc">!=</span> <span class="st">"All"</span>) {</span>
<span id="cb4-798"><a href="#cb4-798" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(body_part <span class="sc">==</span> input<span class="sc">$</span>body_part_filter)</span>
<span id="cb4-799"><a href="#cb4-799" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-800"><a href="#cb4-800" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-801"><a href="#cb4-801" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter by event category if a specific category is selected</span></span>
<span id="cb4-802"><a href="#cb4-802" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>event_filter <span class="sc">!=</span> <span class="st">"All"</span>) {</span>
<span id="cb4-803"><a href="#cb4-803" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(event_category <span class="sc">==</span> input<span class="sc">$</span>event_filter)</span>
<span id="cb4-804"><a href="#cb4-804" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-805"><a href="#cb4-805" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-806"><a href="#cb4-806" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter by source category if a specific category is selected</span></span>
<span id="cb4-807"><a href="#cb4-807" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>source_filter <span class="sc">!=</span> <span class="st">"All"</span>) {</span>
<span id="cb4-808"><a href="#cb4-808" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(source_category <span class="sc">==</span> input<span class="sc">$</span>source_filter)</span>
<span id="cb4-809"><a href="#cb4-809" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-810"><a href="#cb4-810" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-811"><a href="#cb4-811" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Format the state and city columns to have only the first letter in uppercase</span></span>
<span id="cb4-812"><a href="#cb4-812" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> </span>
<span id="cb4-813"><a href="#cb4-813" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb4-814"><a href="#cb4-814" aria-hidden="true" tabindex="-1"></a>        <span class="at">state =</span> stringr<span class="sc">::</span><span class="fu">str_to_title</span>(state),</span>
<span id="cb4-815"><a href="#cb4-815" aria-hidden="true" tabindex="-1"></a>        <span class="at">city =</span> stringr<span class="sc">::</span><span class="fu">str_to_title</span>(city)</span>
<span id="cb4-816"><a href="#cb4-816" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-817"><a href="#cb4-817" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-818"><a href="#cb4-818" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the filtered dataset</span></span>
<span id="cb4-819"><a href="#cb4-819" aria-hidden="true" tabindex="-1"></a>    data</span>
<span id="cb4-820"><a href="#cb4-820" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-821"><a href="#cb4-821" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-822"><a href="#cb4-822" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Render a data table with the filtered data</span></span>
<span id="cb4-823"><a href="#cb4-823" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>filtered_table <span class="ot">&lt;-</span> <span class="fu">renderDT</span>({</span>
<span id="cb4-824"><a href="#cb4-824" aria-hidden="true" tabindex="-1"></a>    <span class="fu">datatable</span>(</span>
<span id="cb4-825"><a href="#cb4-825" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filtered_data</span>(), </span>
<span id="cb4-826"><a href="#cb4-826" aria-hidden="true" tabindex="-1"></a>      <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span>
<span id="cb4-827"><a href="#cb4-827" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-828"><a href="#cb4-828" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-829"><a href="#cb4-829" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Download handler for exporting the filtered data</span></span>
<span id="cb4-830"><a href="#cb4-830" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>download_data <span class="ot">&lt;-</span> <span class="fu">downloadHandler</span>(</span>
<span id="cb4-831"><a href="#cb4-831" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="cf">function</span>() {</span>
<span id="cb4-832"><a href="#cb4-832" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(<span class="st">"filtered_data_"</span>, <span class="fu">Sys.time</span>(), <span class="st">".csv"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb4-833"><a href="#cb4-833" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb4-834"><a href="#cb4-834" aria-hidden="true" tabindex="-1"></a>    <span class="at">content =</span> <span class="cf">function</span>(file) {</span>
<span id="cb4-835"><a href="#cb4-835" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Write the filtered data to a CSV file</span></span>
<span id="cb4-836"><a href="#cb4-836" aria-hidden="true" tabindex="-1"></a>      <span class="fu">write.csv</span>(<span class="fu">filtered_data</span>(), file, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-837"><a href="#cb4-837" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-838"><a href="#cb4-838" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-839"><a href="#cb4-839" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-840"><a href="#cb4-840" aria-hidden="true" tabindex="-1"></a>  <span class="co"># OCCUPATIONAL ILLNESS</span></span>
<span id="cb4-841"><a href="#cb4-841" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-842"><a href="#cb4-842" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Illnesses by State Analysis</span></span>
<span id="cb4-843"><a href="#cb4-843" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>state_plot_occ <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb4-844"><a href="#cb4-844" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the data by the selected year and calculate the total injuries for each state</span></span>
<span id="cb4-845"><a href="#cb4-845" aria-hidden="true" tabindex="-1"></a>    state_summary_occ <span class="ot">&lt;-</span> occ_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-846"><a href="#cb4-846" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> input<span class="sc">$</span>year_occ) <span class="sc">|&gt;</span></span>
<span id="cb4-847"><a href="#cb4-847" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb4-848"><a href="#cb4-848" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">Total_Injuries =</span> <span class="fu">sum</span>(total_injuries, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb4-849"><a href="#cb4-849" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-850"><a href="#cb4-850" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load US state map data</span></span>
<span id="cb4-851"><a href="#cb4-851" aria-hidden="true" tabindex="-1"></a>    us_states <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">"state"</span>)</span>
<span id="cb4-852"><a href="#cb4-852" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-853"><a href="#cb4-853" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge the summarized injury data with the US map data by matching the "state" and "region" columns</span></span>
<span id="cb4-854"><a href="#cb4-854" aria-hidden="true" tabindex="-1"></a>    map_data_combined <span class="ot">&lt;-</span> us_states <span class="sc">|&gt;</span></span>
<span id="cb4-855"><a href="#cb4-855" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(state_summary_occ, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"region"</span> <span class="ot">=</span> <span class="st">"state"</span>))</span>
<span id="cb4-856"><a href="#cb4-856" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-857"><a href="#cb4-857" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create hover text for displaying additional information when hovering over a state in the map</span></span>
<span id="cb4-858"><a href="#cb4-858" aria-hidden="true" tabindex="-1"></a>    map_data_combined<span class="sc">$</span>hover_text <span class="ot">&lt;-</span> <span class="fu">paste</span>(</span>
<span id="cb4-859"><a href="#cb4-859" aria-hidden="true" tabindex="-1"></a>      <span class="st">"State:"</span>, map_data_combined<span class="sc">$</span>region,</span>
<span id="cb4-860"><a href="#cb4-860" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&lt;br&gt;Total Injuries:"</span>, map_data_combined<span class="sc">$</span>Total_Injuries</span>
<span id="cb4-861"><a href="#cb4-861" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-862"><a href="#cb4-862" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-863"><a href="#cb4-863" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create the map plot using ggplot</span></span>
<span id="cb4-864"><a href="#cb4-864" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(map_data_combined, <span class="fu">aes</span>(</span>
<span id="cb4-865"><a href="#cb4-865" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group, <span class="at">fill =</span> Total_Injuries, <span class="at">text =</span> hover_text</span>
<span id="cb4-866"><a href="#cb4-866" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span></span>
<span id="cb4-867"><a href="#cb4-867" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_polygon</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb4-868"><a href="#cb4-868" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_fixed</span>(<span class="fl">1.3</span>) <span class="sc">+</span></span>
<span id="cb4-869"><a href="#cb4-869" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"#336699"</span>, <span class="at">high =</span> <span class="st">"#003366"</span>, <span class="at">na.value =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb4-870"><a href="#cb4-870" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb4-871"><a href="#cb4-871" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Total Occupational Illness by State for"</span>, input<span class="sc">$</span>year_occ),</span>
<span id="cb4-872"><a href="#cb4-872" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"Total Injuries"</span></span>
<span id="cb4-873"><a href="#cb4-873" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-874"><a href="#cb4-874" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-875"><a href="#cb4-875" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb4-876"><a href="#cb4-876" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-877"><a href="#cb4-877" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-878"><a href="#cb4-878" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-879"><a href="#cb4-879" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-880"><a href="#cb4-880" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb4-881"><a href="#cb4-881" aria-hidden="true" tabindex="-1"></a>          <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb4-882"><a href="#cb4-882" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="dv">16</span>,</span>
<span id="cb4-883"><a href="#cb4-883" aria-hidden="true" tabindex="-1"></a>          <span class="at">face =</span> <span class="st">"bold"</span></span>
<span id="cb4-884"><a href="#cb4-884" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-885"><a href="#cb4-885" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-886"><a href="#cb4-886" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert the ggplot to interactive plotly plot</span></span>
<span id="cb4-887"><a href="#cb4-887" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplotly</span>(p, <span class="at">tooltip =</span> <span class="st">"text"</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-888"><a href="#cb4-888" aria-hidden="true" tabindex="-1"></a>      <span class="fu">layout</span>(</span>
<span id="cb4-889"><a href="#cb4-889" aria-hidden="true" tabindex="-1"></a>        <span class="at">hoverlabel =</span> <span class="fu">list</span>(<span class="at">bgcolor =</span> <span class="st">"white"</span>, <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">12</span>)),</span>
<span id="cb4-890"><a href="#cb4-890" aria-hidden="true" tabindex="-1"></a>        <span class="at">hovermode =</span> <span class="st">"closest"</span></span>
<span id="cb4-891"><a href="#cb4-891" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb4-892"><a href="#cb4-892" aria-hidden="true" tabindex="-1"></a>      <span class="fu">config</span>(</span>
<span id="cb4-893"><a href="#cb4-893" aria-hidden="true" tabindex="-1"></a>        <span class="at">modeBarButtonsToRemove =</span> <span class="fu">c</span>(</span>
<span id="cb4-894"><a href="#cb4-894" aria-hidden="true" tabindex="-1"></a>          <span class="st">"pan2d"</span>, <span class="st">"select2d"</span>, <span class="st">"lasso2d"</span>, <span class="st">"autoScale2d"</span>, <span class="st">"resetScale2d"</span>, </span>
<span id="cb4-895"><a href="#cb4-895" aria-hidden="true" tabindex="-1"></a>          <span class="st">"hoverClosestCartesian"</span>, <span class="st">"hoverCompareCartesian"</span>, </span>
<span id="cb4-896"><a href="#cb4-896" aria-hidden="true" tabindex="-1"></a>          <span class="st">"zoom2d"</span>, <span class="st">"sendDataToCloud"</span></span>
<span id="cb4-897"><a href="#cb4-897" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb4-898"><a href="#cb4-898" aria-hidden="true" tabindex="-1"></a>        <span class="at">displaylogo =</span> <span class="cn">FALSE</span>  <span class="co"># Hide the Plotly logo</span></span>
<span id="cb4-899"><a href="#cb4-899" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-900"><a href="#cb4-900" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-901"><a href="#cb4-901" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-902"><a href="#cb4-902" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Top Occupational Industries Analysis</span></span>
<span id="cb4-903"><a href="#cb4-903" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-904"><a href="#cb4-904" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Render pie chart of the top 5 industries with the highest number of occupational injuries</span></span>
<span id="cb4-905"><a href="#cb4-905" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>industry_pie_chart_occ <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb4-906"><a href="#cb4-906" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data based on selected year, group by industry, and calculate total injuries per industry</span></span>
<span id="cb4-907"><a href="#cb4-907" aria-hidden="true" tabindex="-1"></a>    industry_data <span class="ot">&lt;-</span> occ_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-908"><a href="#cb4-908" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> input<span class="sc">$</span>year_industry_occ) <span class="sc">|&gt;</span></span>
<span id="cb4-909"><a href="#cb4-909" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(industry) <span class="sc">|&gt;</span></span>
<span id="cb4-910"><a href="#cb4-910" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">Total_Injuries =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-911"><a href="#cb4-911" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(Total_Injuries)) <span class="sc">|&gt;</span></span>
<span id="cb4-912"><a href="#cb4-912" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Percentage =</span> <span class="fu">round</span>((Total_Injuries <span class="sc">/</span> <span class="fu">sum</span>(Total_Injuries)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-913"><a href="#cb4-913" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb4-914"><a href="#cb4-914" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-915"><a href="#cb4-915" aria-hidden="true" tabindex="-1"></a>    custom_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#336699"</span>, <span class="st">"#003366"</span>, <span class="st">"#4d4d4d"</span>, <span class="st">"#99ccff"</span>, <span class="st">"#1a1a1a"</span>)</span>
<span id="cb4-916"><a href="#cb4-916" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-917"><a href="#cb4-917" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create pie chart with custom colors and labels</span></span>
<span id="cb4-918"><a href="#cb4-918" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(industry_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> Total_Injuries, <span class="at">fill =</span> industry)) <span class="sc">+</span></span>
<span id="cb4-919"><a href="#cb4-919" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb4-920"><a href="#cb4-920" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb4-921"><a href="#cb4-921" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(Percentage, <span class="st">"%"</span>)),</span>
<span id="cb4-922"><a href="#cb4-922" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb4-923"><a href="#cb4-923" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb4-924"><a href="#cb4-924" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Top 5 Industries for Occupational Injuries in"</span>, input<span class="sc">$</span>year_industry_occ),</span>
<span id="cb4-925"><a href="#cb4-925" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"Industry"</span></span>
<span id="cb4-926"><a href="#cb4-926" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-927"><a href="#cb4-927" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb4-928"><a href="#cb4-928" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb4-929"><a href="#cb4-929" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb4-930"><a href="#cb4-930" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb4-931"><a href="#cb4-931" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb4-932"><a href="#cb4-932" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-933"><a href="#cb4-933" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors)</span>
<span id="cb4-934"><a href="#cb4-934" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-935"><a href="#cb4-935" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-936"><a href="#cb4-936" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Render table showing total injuries and percentage of injuries by industry</span></span>
<span id="cb4-937"><a href="#cb4-937" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>industry_table_occ <span class="ot">&lt;-</span> <span class="fu">renderTable</span>({</span>
<span id="cb4-938"><a href="#cb4-938" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate total number of injuries for the selected year</span></span>
<span id="cb4-939"><a href="#cb4-939" aria-hidden="true" tabindex="-1"></a>    total_injuries <span class="ot">&lt;-</span> occ_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-940"><a href="#cb4-940" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> input<span class="sc">$</span>year_industry_occ) <span class="sc">|&gt;</span></span>
<span id="cb4-941"><a href="#cb4-941" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">Total_Injuries =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-942"><a href="#cb4-942" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(Total_Injuries)</span>
<span id="cb4-943"><a href="#cb4-943" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-944"><a href="#cb4-944" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Summarize injuries by industry, calculate percentage for each industry</span></span>
<span id="cb4-945"><a href="#cb4-945" aria-hidden="true" tabindex="-1"></a>    industry_data <span class="ot">&lt;-</span> occ_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-946"><a href="#cb4-946" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> input<span class="sc">$</span>year_industry_occ) <span class="sc">|&gt;</span></span>
<span id="cb4-947"><a href="#cb4-947" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(industry) <span class="sc">|&gt;</span></span>
<span id="cb4-948"><a href="#cb4-948" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">Total_Injuries =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-949"><a href="#cb4-949" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(Total_Injuries)) <span class="sc">|&gt;</span></span>
<span id="cb4-950"><a href="#cb4-950" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Percentage =</span> <span class="fu">round</span>((Total_Injuries <span class="sc">/</span> total_injuries) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-951"><a href="#cb4-951" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(</span>
<span id="cb4-952"><a href="#cb4-952" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Industry</span><span class="st">`</span> <span class="ot">=</span> industry,</span>
<span id="cb4-953"><a href="#cb4-953" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Total Injuries</span><span class="st">`</span> <span class="ot">=</span> Total_Injuries,</span>
<span id="cb4-954"><a href="#cb4-954" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Percentage (%)</span><span class="st">`</span> <span class="ot">=</span> Percentage</span>
<span id="cb4-955"><a href="#cb4-955" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-956"><a href="#cb4-956" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the summarized data as a table</span></span>
<span id="cb4-957"><a href="#cb4-957" aria-hidden="true" tabindex="-1"></a>    industry_data</span>
<span id="cb4-958"><a href="#cb4-958" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-959"><a href="#cb4-959" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-960"><a href="#cb4-960" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Download the top industries pie chart as a PNG image</span></span>
<span id="cb4-961"><a href="#cb4-961" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>download_industry_plot_occ <span class="ot">&lt;-</span> <span class="fu">downloadHandler</span>(</span>
<span id="cb4-962"><a href="#cb4-962" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define filename format for the downloaded image</span></span>
<span id="cb4-963"><a href="#cb4-963" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="cf">function</span>() {</span>
<span id="cb4-964"><a href="#cb4-964" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(<span class="st">"top_occ_industries_pie_chart_"</span>, <span class="fu">Sys.time</span>(), <span class="st">".png"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb4-965"><a href="#cb4-965" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb4-966"><a href="#cb4-966" aria-hidden="true" tabindex="-1"></a>    <span class="at">content =</span> <span class="cf">function</span>(file) {</span>
<span id="cb4-967"><a href="#cb4-967" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Generate the top 5 industries data for the pie chart</span></span>
<span id="cb4-968"><a href="#cb4-968" aria-hidden="true" tabindex="-1"></a>      industry_data <span class="ot">&lt;-</span> occ_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-969"><a href="#cb4-969" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(year <span class="sc">==</span> input<span class="sc">$</span>year_industry_occ) <span class="sc">|&gt;</span></span>
<span id="cb4-970"><a href="#cb4-970" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(industry) <span class="sc">|&gt;</span></span>
<span id="cb4-971"><a href="#cb4-971" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">Total_Injuries =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-972"><a href="#cb4-972" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(<span class="fu">desc</span>(Total_Injuries)) <span class="sc">|&gt;</span></span>
<span id="cb4-973"><a href="#cb4-973" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">Percentage =</span> <span class="fu">round</span>((Total_Injuries <span class="sc">/</span> <span class="fu">sum</span>(Total_Injuries)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-974"><a href="#cb4-974" aria-hidden="true" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb4-975"><a href="#cb4-975" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-976"><a href="#cb4-976" aria-hidden="true" tabindex="-1"></a>      custom_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#336699"</span>, <span class="st">"#003366"</span>, <span class="st">"#4d4d4d"</span>, <span class="st">"#99ccff"</span>, <span class="st">"#1a1a1a"</span>)</span>
<span id="cb4-977"><a href="#cb4-977" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-978"><a href="#cb4-978" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Create pie chart plot</span></span>
<span id="cb4-979"><a href="#cb4-979" aria-hidden="true" tabindex="-1"></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(industry_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> Total_Injuries, <span class="at">fill =</span> industry)) <span class="sc">+</span></span>
<span id="cb4-980"><a href="#cb4-980" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb4-981"><a href="#cb4-981" aria-hidden="true" tabindex="-1"></a>        <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb4-982"><a href="#cb4-982" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(Percentage, <span class="st">"%"</span>)),</span>
<span id="cb4-983"><a href="#cb4-983" aria-hidden="true" tabindex="-1"></a>                  <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb4-984"><a href="#cb4-984" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(</span>
<span id="cb4-985"><a href="#cb4-985" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Top 5 Industries for Occupational Injuries in"</span>, input<span class="sc">$</span>year_industry_occ),</span>
<span id="cb4-986"><a href="#cb4-986" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"Industry"</span></span>
<span id="cb4-987"><a href="#cb4-987" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb4-988"><a href="#cb4-988" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb4-989"><a href="#cb4-989" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(</span>
<span id="cb4-990"><a href="#cb4-990" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb4-991"><a href="#cb4-991" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb4-992"><a href="#cb4-992" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb4-993"><a href="#cb4-993" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb4-994"><a href="#cb4-994" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors)</span>
<span id="cb4-995"><a href="#cb4-995" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-996"><a href="#cb4-996" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Save the plot as a PNG file</span></span>
<span id="cb4-997"><a href="#cb4-997" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggsave</span>(file, <span class="at">plot =</span> p, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb4-998"><a href="#cb4-998" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-999"><a href="#cb4-999" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-1000"><a href="#cb4-1000" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-1001"><a href="#cb4-1001" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-1002"><a href="#cb4-1002" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Top States Analysis</span></span>
<span id="cb4-1003"><a href="#cb4-1003" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-1004"><a href="#cb4-1004" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Render the plot for the top 5 states by total occupational illness</span></span>
<span id="cb4-1005"><a href="#cb4-1005" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>top_states_plot_occ <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb4-1006"><a href="#cb4-1006" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data by the selected year and calculate total injuries for each state</span></span>
<span id="cb4-1007"><a href="#cb4-1007" aria-hidden="true" tabindex="-1"></a>    top_states <span class="ot">&lt;-</span> occ_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-1008"><a href="#cb4-1008" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> input<span class="sc">$</span>year_state_occ) <span class="sc">|&gt;</span></span>
<span id="cb4-1009"><a href="#cb4-1009" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb4-1010"><a href="#cb4-1010" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">Total_Injuries =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-1011"><a href="#cb4-1011" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">state =</span> stringr<span class="sc">::</span><span class="fu">str_to_title</span>(state)) <span class="sc">|&gt;</span></span>
<span id="cb4-1012"><a href="#cb4-1012" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(Total_Injuries)) <span class="sc">|&gt;</span></span>
<span id="cb4-1013"><a href="#cb4-1013" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb4-1014"><a href="#cb4-1014" aria-hidden="true" tabindex="-1"></a>    custom_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#336699"</span>, <span class="st">"#003366"</span>, <span class="st">"#4d4d4d"</span>, <span class="st">"#99ccff"</span>, <span class="st">"#1a1a1a"</span>)</span>
<span id="cb4-1015"><a href="#cb4-1015" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1016"><a href="#cb4-1016" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a bar chart for the top 5 states by total injuries</span></span>
<span id="cb4-1017"><a href="#cb4-1017" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(top_states, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(state, Total_Injuries), <span class="at">y =</span> Total_Injuries, <span class="at">fill =</span> state)) <span class="sc">+</span></span>
<span id="cb4-1018"><a href="#cb4-1018" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_col</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb4-1019"><a href="#cb4-1019" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb4-1020"><a href="#cb4-1020" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb4-1021"><a href="#cb4-1021" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Top 5 States by Total Occupational Illness in"</span>, input<span class="sc">$</span>year_state_occ),</span>
<span id="cb4-1022"><a href="#cb4-1022" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"State"</span>,</span>
<span id="cb4-1023"><a href="#cb4-1023" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Total Illness"</span></span>
<span id="cb4-1024"><a href="#cb4-1024" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-1025"><a href="#cb4-1025" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-1026"><a href="#cb4-1026" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb4-1027"><a href="#cb4-1027" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb4-1028"><a href="#cb4-1028" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-1029"><a href="#cb4-1029" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>,<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-1030"><a href="#cb4-1030" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb4-1031"><a href="#cb4-1031" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb4-1032"><a href="#cb4-1032" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-1033"><a href="#cb4-1033" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors) <span class="sc">+</span></span>
<span id="cb4-1034"><a href="#cb4-1034" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma)</span>
<span id="cb4-1035"><a href="#cb4-1035" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-1036"><a href="#cb4-1036" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-1037"><a href="#cb4-1037" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Render a table for all the states</span></span>
<span id="cb4-1038"><a href="#cb4-1038" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>states_table_occ <span class="ot">&lt;-</span> <span class="fu">renderTable</span>({</span>
<span id="cb4-1039"><a href="#cb4-1039" aria-hidden="true" tabindex="-1"></a>    all_states <span class="ot">&lt;-</span> occ_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-1040"><a href="#cb4-1040" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> input<span class="sc">$</span>year_state_occ) <span class="sc">|&gt;</span></span>
<span id="cb4-1041"><a href="#cb4-1041" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb4-1042"><a href="#cb4-1042" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(</span>
<span id="cb4-1043"><a href="#cb4-1043" aria-hidden="true" tabindex="-1"></a>        <span class="at">Total_Injuries =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-1044"><a href="#cb4-1044" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">state =</span> stringr<span class="sc">::</span><span class="fu">str_to_title</span>(state)) <span class="sc">|&gt;</span></span>
<span id="cb4-1045"><a href="#cb4-1045" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(Total_Injuries)) <span class="sc">|&gt;</span></span>
<span id="cb4-1046"><a href="#cb4-1046" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(</span>
<span id="cb4-1047"><a href="#cb4-1047" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">State</span><span class="st">`</span> <span class="ot">=</span> state,</span>
<span id="cb4-1048"><a href="#cb4-1048" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Total Injuries</span><span class="st">`</span> <span class="ot">=</span> Total_Injuries</span>
<span id="cb4-1049"><a href="#cb4-1049" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-1050"><a href="#cb4-1050" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the table for all the states</span></span>
<span id="cb4-1051"><a href="#cb4-1051" aria-hidden="true" tabindex="-1"></a>    all_states</span>
<span id="cb4-1052"><a href="#cb4-1052" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-1053"><a href="#cb4-1053" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-1054"><a href="#cb4-1054" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Download handler for the top states plot</span></span>
<span id="cb4-1055"><a href="#cb4-1055" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>download_top_states_plot_occ <span class="ot">&lt;-</span> <span class="fu">downloadHandler</span>(</span>
<span id="cb4-1056"><a href="#cb4-1056" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="cf">function</span>() {</span>
<span id="cb4-1057"><a href="#cb4-1057" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(<span class="st">"top_states_plot_"</span>, <span class="fu">Sys.time</span>(), <span class="st">".png"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb4-1058"><a href="#cb4-1058" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb4-1059"><a href="#cb4-1059" aria-hidden="true" tabindex="-1"></a>    <span class="at">content =</span> <span class="cf">function</span>(file) {</span>
<span id="cb4-1060"><a href="#cb4-1060" aria-hidden="true" tabindex="-1"></a>      top_states <span class="ot">&lt;-</span> occ_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-1061"><a href="#cb4-1061" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(year <span class="sc">==</span> input<span class="sc">$</span>year_state_occ) <span class="sc">|&gt;</span></span>
<span id="cb4-1062"><a href="#cb4-1062" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb4-1063"><a href="#cb4-1063" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">Total_Injuries =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-1064"><a href="#cb4-1064" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">state =</span> stringr<span class="sc">::</span><span class="fu">str_to_title</span>(state)) <span class="sc">|&gt;</span></span>
<span id="cb4-1065"><a href="#cb4-1065" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(<span class="fu">desc</span>(Total_Injuries)) <span class="sc">|&gt;</span></span>
<span id="cb4-1066"><a href="#cb4-1066" aria-hidden="true" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb4-1067"><a href="#cb4-1067" aria-hidden="true" tabindex="-1"></a>      custom_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#336699"</span>, <span class="st">"#003366"</span>, <span class="st">"#4d4d4d"</span>, <span class="st">"#99ccff"</span>, <span class="st">"#1a1a1a"</span>)</span>
<span id="cb4-1068"><a href="#cb4-1068" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-1069"><a href="#cb4-1069" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Create the plot for the top 5 states</span></span>
<span id="cb4-1070"><a href="#cb4-1070" aria-hidden="true" tabindex="-1"></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(top_states, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(state, Total_Injuries), <span class="at">y =</span> Total_Injuries, <span class="at">fill =</span> state)) <span class="sc">+</span></span>
<span id="cb4-1071"><a href="#cb4-1071" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_col</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb4-1072"><a href="#cb4-1072" aria-hidden="true" tabindex="-1"></a>        <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb4-1073"><a href="#cb4-1073" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(</span>
<span id="cb4-1074"><a href="#cb4-1074" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Top 5 States by Total Occupational Illness in"</span>, input<span class="sc">$</span>year_state_occ),</span>
<span id="cb4-1075"><a href="#cb4-1075" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> <span class="st">"State"</span>,</span>
<span id="cb4-1076"><a href="#cb4-1076" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="st">"Total Illness"</span></span>
<span id="cb4-1077"><a href="#cb4-1077" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb4-1078"><a href="#cb4-1078" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-1079"><a href="#cb4-1079" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(</span>
<span id="cb4-1080"><a href="#cb4-1080" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb4-1081"><a href="#cb4-1081" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-1082"><a href="#cb4-1082" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>,<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-1083"><a href="#cb4-1083" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb4-1084"><a href="#cb4-1084" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb4-1085"><a href="#cb4-1085" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb4-1086"><a href="#cb4-1086" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors) <span class="sc">+</span></span>
<span id="cb4-1087"><a href="#cb4-1087" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma)</span>
<span id="cb4-1088"><a href="#cb4-1088" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-1089"><a href="#cb4-1089" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Save the plot as a PNG file</span></span>
<span id="cb4-1090"><a href="#cb4-1090" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggsave</span>(file, <span class="at">plot =</span> p, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb4-1091"><a href="#cb4-1091" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-1092"><a href="#cb4-1092" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-1093"><a href="#cb4-1093" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-1094"><a href="#cb4-1094" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Key Injury Metric by Industry</span></span>
<span id="cb4-1095"><a href="#cb4-1095" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-1096"><a href="#cb4-1096" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Render dynamic title for the occupational illness visualization based on the selected industry</span></span>
<span id="cb4-1097"><a href="#cb4-1097" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>dynamic_title <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb4-1098"><a href="#cb4-1098" aria-hidden="true" tabindex="-1"></a>    title <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Occupational Illness Visualization for"</span>, input<span class="sc">$</span>select_industry_occ, <span class="st">"in"</span>, input<span class="sc">$</span>year_filter_industry_occ)</span>
<span id="cb4-1099"><a href="#cb4-1099" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1100"><a href="#cb4-1100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">div</span>(</span>
<span id="cb4-1101"><a href="#cb4-1101" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="st">"text-align: center; font-size: 24px; font-weight: bold; margin-bottom: 5px;"</span>,</span>
<span id="cb4-1102"><a href="#cb4-1102" aria-hidden="true" tabindex="-1"></a>      title</span>
<span id="cb4-1103"><a href="#cb4-1103" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-1104"><a href="#cb4-1104" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-1105"><a href="#cb4-1105" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-1106"><a href="#cb4-1106" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reactive data filtering based on the selected industry and year</span></span>
<span id="cb4-1107"><a href="#cb4-1107" aria-hidden="true" tabindex="-1"></a>  filtered_data_occ <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb4-1108"><a href="#cb4-1108" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> occ_injuries_data <span class="sc">|&gt;</span></span>
<span id="cb4-1109"><a href="#cb4-1109" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> input<span class="sc">$</span>year_filter_industry_occ)</span>
<span id="cb4-1110"><a href="#cb4-1110" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1111"><a href="#cb4-1111" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the data by industry if selected</span></span>
<span id="cb4-1112"><a href="#cb4-1112" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>select_industry_occ <span class="sc">!=</span> <span class="st">"All Industries"</span>) {</span>
<span id="cb4-1113"><a href="#cb4-1113" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(industry <span class="sc">==</span> input<span class="sc">$</span>select_industry_occ)</span>
<span id="cb4-1114"><a href="#cb4-1114" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-1115"><a href="#cb4-1115" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1116"><a href="#cb4-1116" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(data)</span>
<span id="cb4-1117"><a href="#cb4-1117" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-1118"><a href="#cb4-1118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1119"><a href="#cb4-1119" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Render plot for employee details such as average employees and hours worked</span></span>
<span id="cb4-1120"><a href="#cb4-1120" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>illness_employees_plot_occ <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb4-1121"><a href="#cb4-1121" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">filtered_data_occ</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-1122"><a href="#cb4-1122" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(</span>
<span id="cb4-1123"><a href="#cb4-1123" aria-hidden="true" tabindex="-1"></a>        <span class="at">Avg_Employees =</span> <span class="fu">sum</span>(annual_average_employees, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-1124"><a href="#cb4-1124" aria-hidden="true" tabindex="-1"></a>        <span class="at">Hours_Worked =</span> <span class="fu">sum</span>(total_hours_worked, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-1125"><a href="#cb4-1125" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-1126"><a href="#cb4-1126" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1127"><a href="#cb4-1127" aria-hidden="true" tabindex="-1"></a>    bar_data <span class="ot">&lt;-</span> <span class="fu">gather</span>(data, <span class="at">key =</span> <span class="st">"Metric"</span>, <span class="at">value =</span> <span class="st">"Value"</span>)</span>
<span id="cb4-1128"><a href="#cb4-1128" aria-hidden="true" tabindex="-1"></a>    custom_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#336699"</span>, <span class="st">"#003366"</span>)</span>
<span id="cb4-1129"><a href="#cb4-1129" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1130"><a href="#cb4-1130" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a bar plot with labels and formatting</span></span>
<span id="cb4-1131"><a href="#cb4-1131" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(bar_data, <span class="fu">aes</span>(<span class="at">x =</span> Metric, <span class="at">y =</span> Value, <span class="at">fill =</span> Metric)) <span class="sc">+</span></span>
<span id="cb4-1132"><a href="#cb4-1132" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb4-1133"><a href="#cb4-1133" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">comma</span>(Value)),</span>
<span id="cb4-1134"><a href="#cb4-1134" aria-hidden="true" tabindex="-1"></a>                <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb4-1135"><a href="#cb4-1135" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb4-1136"><a href="#cb4-1136" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Employee Details"</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Value"</span>) <span class="sc">+</span></span>
<span id="cb4-1137"><a href="#cb4-1137" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-1138"><a href="#cb4-1138" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb4-1139"><a href="#cb4-1139" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb4-1140"><a href="#cb4-1140" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-1141"><a href="#cb4-1141" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb4-1142"><a href="#cb4-1142" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb4-1143"><a href="#cb4-1143" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>),</span>
<span id="cb4-1144"><a href="#cb4-1144" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>)</span>
<span id="cb4-1145"><a href="#cb4-1145" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-1146"><a href="#cb4-1146" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors)</span>
<span id="cb4-1147"><a href="#cb4-1147" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-1148"><a href="#cb4-1148" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-1149"><a href="#cb4-1149" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Render plot for illness and death statistics</span></span>
<span id="cb4-1150"><a href="#cb4-1150" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>illness_deaths_plot_occ <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb4-1151"><a href="#cb4-1151" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">filtered_data_occ</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-1152"><a href="#cb4-1152" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(</span>
<span id="cb4-1153"><a href="#cb4-1153" aria-hidden="true" tabindex="-1"></a>        <span class="at">Deaths =</span> <span class="fu">sum</span>(total_deaths, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-1154"><a href="#cb4-1154" aria-hidden="true" tabindex="-1"></a>        <span class="at">Illnesses =</span> <span class="fu">sum</span>(total_injuries, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-1155"><a href="#cb4-1155" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-1156"><a href="#cb4-1156" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1157"><a href="#cb4-1157" aria-hidden="true" tabindex="-1"></a>    bar_data <span class="ot">&lt;-</span> <span class="fu">gather</span>(data, <span class="at">key =</span> <span class="st">"Metric"</span>, <span class="at">value =</span> <span class="st">"Value"</span>)</span>
<span id="cb4-1158"><a href="#cb4-1158" aria-hidden="true" tabindex="-1"></a>    custom_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#336699"</span>, <span class="st">"#003366"</span>)</span>
<span id="cb4-1159"><a href="#cb4-1159" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1160"><a href="#cb4-1160" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a bar plot with illness and death counts</span></span>
<span id="cb4-1161"><a href="#cb4-1161" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(bar_data, <span class="fu">aes</span>(<span class="at">x =</span> Metric, <span class="at">y =</span> Value, <span class="at">fill =</span> Metric)) <span class="sc">+</span></span>
<span id="cb4-1162"><a href="#cb4-1162" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb4-1163"><a href="#cb4-1163" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">comma</span>(Value)),</span>
<span id="cb4-1164"><a href="#cb4-1164" aria-hidden="true" tabindex="-1"></a>                <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb4-1165"><a href="#cb4-1165" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb4-1166"><a href="#cb4-1166" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Count of Illness"</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Value"</span>) <span class="sc">+</span></span>
<span id="cb4-1167"><a href="#cb4-1167" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-1168"><a href="#cb4-1168" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb4-1169"><a href="#cb4-1169" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb4-1170"><a href="#cb4-1170" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-1171"><a href="#cb4-1171" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb4-1172"><a href="#cb4-1172" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb4-1173"><a href="#cb4-1173" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>),</span>
<span id="cb4-1174"><a href="#cb4-1174" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>)</span>
<span id="cb4-1175"><a href="#cb4-1175" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-1176"><a href="#cb4-1176" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors)</span>
<span id="cb4-1177"><a href="#cb4-1177" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-1178"><a href="#cb4-1178" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-1179"><a href="#cb4-1179" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Render plot for various case types such as DAFW, DJTR, and others</span></span>
<span id="cb4-1180"><a href="#cb4-1180" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>illness_cases_plot_occ <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb4-1181"><a href="#cb4-1181" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">filtered_data_occ</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-1182"><a href="#cb4-1182" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(</span>
<span id="cb4-1183"><a href="#cb4-1183" aria-hidden="true" tabindex="-1"></a>        <span class="at">DAFW_Cases =</span> <span class="fu">sum</span>(total_dafw_cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-1184"><a href="#cb4-1184" aria-hidden="true" tabindex="-1"></a>        <span class="at">DJTR_Cases =</span> <span class="fu">sum</span>(total_djtr_cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-1185"><a href="#cb4-1185" aria-hidden="true" tabindex="-1"></a>        <span class="at">Other_Cases =</span> <span class="fu">sum</span>(total_other_cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-1186"><a href="#cb4-1186" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-1187"><a href="#cb4-1187" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1188"><a href="#cb4-1188" aria-hidden="true" tabindex="-1"></a>    bar_data <span class="ot">&lt;-</span> <span class="fu">gather</span>(data, <span class="at">key =</span> <span class="st">"Case_Type"</span>, <span class="at">value =</span> <span class="st">"Value"</span>)</span>
<span id="cb4-1189"><a href="#cb4-1189" aria-hidden="true" tabindex="-1"></a>    custom_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#336699"</span>, <span class="st">"#003366"</span>, <span class="st">"#4d4d4d"</span>)</span>
<span id="cb4-1190"><a href="#cb4-1190" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1191"><a href="#cb4-1191" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a bar plot with case type counts</span></span>
<span id="cb4-1192"><a href="#cb4-1192" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(bar_data, <span class="fu">aes</span>(<span class="at">x =</span> Case_Type, <span class="at">y =</span> Value, <span class="at">fill =</span> Case_Type)) <span class="sc">+</span></span>
<span id="cb4-1193"><a href="#cb4-1193" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb4-1194"><a href="#cb4-1194" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">comma</span>(Value)),</span>
<span id="cb4-1195"><a href="#cb4-1195" aria-hidden="true" tabindex="-1"></a>                <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb4-1196"><a href="#cb4-1196" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb4-1197"><a href="#cb4-1197" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Different Cases"</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Value"</span>) <span class="sc">+</span></span>
<span id="cb4-1198"><a href="#cb4-1198" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-1199"><a href="#cb4-1199" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb4-1200"><a href="#cb4-1200" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb4-1201"><a href="#cb4-1201" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-1202"><a href="#cb4-1202" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb4-1203"><a href="#cb4-1203" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb4-1204"><a href="#cb4-1204" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>),</span>
<span id="cb4-1205"><a href="#cb4-1205" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>)</span>
<span id="cb4-1206"><a href="#cb4-1206" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-1207"><a href="#cb4-1207" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors)</span>
<span id="cb4-1208"><a href="#cb4-1208" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-1209"><a href="#cb4-1209" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-1210"><a href="#cb4-1210" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Render plot for time duration statistics (DAFW and DJTR days)</span></span>
<span id="cb4-1211"><a href="#cb4-1211" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>illness_days_plot_occ <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb4-1212"><a href="#cb4-1212" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">filtered_data_occ</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-1213"><a href="#cb4-1213" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(</span>
<span id="cb4-1214"><a href="#cb4-1214" aria-hidden="true" tabindex="-1"></a>        <span class="at">DAFW_Days =</span> <span class="fu">sum</span>(total_dafw_days, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-1215"><a href="#cb4-1215" aria-hidden="true" tabindex="-1"></a>        <span class="at">DJTR_Days =</span> <span class="fu">sum</span>(total_djtr_days, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-1216"><a href="#cb4-1216" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-1217"><a href="#cb4-1217" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1218"><a href="#cb4-1218" aria-hidden="true" tabindex="-1"></a>    bar_data <span class="ot">&lt;-</span> <span class="fu">gather</span>(data, <span class="at">key =</span> <span class="st">"Days_Type"</span>, <span class="at">value =</span> <span class="st">"Value"</span>)</span>
<span id="cb4-1219"><a href="#cb4-1219" aria-hidden="true" tabindex="-1"></a>    custom_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#336699"</span>, <span class="st">"#003366"</span>)</span>
<span id="cb4-1220"><a href="#cb4-1220" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1221"><a href="#cb4-1221" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a bar plot with time duration counts</span></span>
<span id="cb4-1222"><a href="#cb4-1222" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(bar_data, <span class="fu">aes</span>(<span class="at">x =</span> Days_Type, <span class="at">y =</span> Value, <span class="at">fill =</span> Days_Type)) <span class="sc">+</span></span>
<span id="cb4-1223"><a href="#cb4-1223" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb4-1224"><a href="#cb4-1224" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">comma</span>(Value)),</span>
<span id="cb4-1225"><a href="#cb4-1225" aria-hidden="true" tabindex="-1"></a>                <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb4-1226"><a href="#cb4-1226" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb4-1227"><a href="#cb4-1227" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Time Duration"</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Days"</span>) <span class="sc">+</span></span>
<span id="cb4-1228"><a href="#cb4-1228" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-1229"><a href="#cb4-1229" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb4-1230"><a href="#cb4-1230" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb4-1231"><a href="#cb4-1231" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-1232"><a href="#cb4-1232" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb4-1233"><a href="#cb4-1233" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb4-1234"><a href="#cb4-1234" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>),</span>
<span id="cb4-1235"><a href="#cb4-1235" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>)</span>
<span id="cb4-1236"><a href="#cb4-1236" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-1237"><a href="#cb4-1237" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors)</span>
<span id="cb4-1238"><a href="#cb4-1238" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-1239"><a href="#cb4-1239" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-1240"><a href="#cb4-1240" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Render plot for illness categories and total illness cases</span></span>
<span id="cb4-1241"><a href="#cb4-1241" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>illness_categories_plot_occ <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb4-1242"><a href="#cb4-1242" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">filtered_data_occ</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-1243"><a href="#cb4-1243" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(</span>
<span id="cb4-1244"><a href="#cb4-1244" aria-hidden="true" tabindex="-1"></a>        <span class="at">Poisonings =</span> <span class="fu">sum</span>(total_poisonings, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-1245"><a href="#cb4-1245" aria-hidden="true" tabindex="-1"></a>        <span class="at">Respiratory =</span> <span class="fu">sum</span>(total_respiratory_conditions, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-1246"><a href="#cb4-1246" aria-hidden="true" tabindex="-1"></a>        <span class="at">Skin_Disorders =</span> <span class="fu">sum</span>(total_skin_disorders, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-1247"><a href="#cb4-1247" aria-hidden="true" tabindex="-1"></a>        <span class="at">Hearing_Loss =</span> <span class="fu">sum</span>(total_hearing_loss, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-1248"><a href="#cb4-1248" aria-hidden="true" tabindex="-1"></a>        <span class="at">Other =</span> <span class="fu">sum</span>(total_other_illnesses, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-1249"><a href="#cb4-1249" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-1250"><a href="#cb4-1250" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1251"><a href="#cb4-1251" aria-hidden="true" tabindex="-1"></a>    bar_data <span class="ot">&lt;-</span> <span class="fu">gather</span>(data, <span class="at">key =</span> <span class="st">"Illness_Type"</span>, <span class="at">value =</span> <span class="st">"Value"</span>)</span>
<span id="cb4-1252"><a href="#cb4-1252" aria-hidden="true" tabindex="-1"></a>    custom_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#336699"</span>, <span class="st">"#003366"</span>, <span class="st">"#4d4d4d"</span>, <span class="st">"#99ccff"</span>, <span class="st">"#1a1a1a"</span>)</span>
<span id="cb4-1253"><a href="#cb4-1253" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1254"><a href="#cb4-1254" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a bar plot for illness categories and illness cases</span></span>
<span id="cb4-1255"><a href="#cb4-1255" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(bar_data, <span class="fu">aes</span>(<span class="at">x =</span> Illness_Type, <span class="at">y =</span> Value, <span class="at">fill =</span> Illness_Type)) <span class="sc">+</span></span>
<span id="cb4-1256"><a href="#cb4-1256" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb4-1257"><a href="#cb4-1257" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">comma</span>(Value)),</span>
<span id="cb4-1258"><a href="#cb4-1258" aria-hidden="true" tabindex="-1"></a>                <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb4-1259"><a href="#cb4-1259" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb4-1260"><a href="#cb4-1260" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Illness Categories vs Illness"</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Total Illness"</span>) <span class="sc">+</span></span>
<span id="cb4-1261"><a href="#cb4-1261" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-1262"><a href="#cb4-1262" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb4-1263"><a href="#cb4-1263" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb4-1264"><a href="#cb4-1264" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-1265"><a href="#cb4-1265" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb4-1266"><a href="#cb4-1266" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb4-1267"><a href="#cb4-1267" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>),</span>
<span id="cb4-1268"><a href="#cb4-1268" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>)</span>
<span id="cb4-1269"><a href="#cb4-1269" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb4-1270"><a href="#cb4-1270" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors)</span>
<span id="cb4-1271"><a href="#cb4-1271" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-1272"><a href="#cb4-1272" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-1273"><a href="#cb4-1273" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>download_industry_interactive_plots <span class="ot">&lt;-</span> <span class="fu">downloadHandler</span>(</span>
<span id="cb4-1274"><a href="#cb4-1274" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define the file name for the downloaded PDF</span></span>
<span id="cb4-1275"><a href="#cb4-1275" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="cf">function</span>() {</span>
<span id="cb4-1276"><a href="#cb4-1276" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(<span class="st">"Summary_Plots"</span>, <span class="fu">Sys.time</span>(), <span class="st">".pdf"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb4-1277"><a href="#cb4-1277" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb4-1278"><a href="#cb4-1278" aria-hidden="true" tabindex="-1"></a>    <span class="at">content =</span> <span class="cf">function</span>(file) {</span>
<span id="cb4-1279"><a href="#cb4-1279" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Open a PDF device to save the plots</span></span>
<span id="cb4-1280"><a href="#cb4-1280" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pdf</span>(file, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>)  <span class="co"># Open a PDF device</span></span>
<span id="cb4-1281"><a href="#cb4-1281" aria-hidden="true" tabindex="-1"></a>      custom_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#336699"</span>, <span class="st">"#003366"</span>, <span class="st">"#4d4d4d"</span>, <span class="st">"#99ccff"</span>, <span class="st">"#1a1a1a"</span>)</span>
<span id="cb4-1282"><a href="#cb4-1282" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-1283"><a href="#cb4-1283" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Render dynamic title for the report</span></span>
<span id="cb4-1284"><a href="#cb4-1284" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>dynamic_title <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb4-1285"><a href="#cb4-1285" aria-hidden="true" tabindex="-1"></a>        title <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Occupational Illness Visualization for"</span>, input<span class="sc">$</span>select_industry_occ, <span class="st">"in"</span>, input<span class="sc">$</span>year_filter_industry_occ)</span>
<span id="cb4-1286"><a href="#cb4-1286" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-1287"><a href="#cb4-1287" aria-hidden="true" tabindex="-1"></a>        <span class="fu">div</span>(</span>
<span id="cb4-1288"><a href="#cb4-1288" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"text-align: center; font-size: 24px; font-weight: bold; margin-bottom: 5px;"</span>,</span>
<span id="cb4-1289"><a href="#cb4-1289" aria-hidden="true" tabindex="-1"></a>          title</span>
<span id="cb4-1290"><a href="#cb4-1290" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-1291"><a href="#cb4-1291" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb4-1292"><a href="#cb4-1292" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-1293"><a href="#cb4-1293" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Plot 1: Annual Average Employees, Total Hours Worked</span></span>
<span id="cb4-1294"><a href="#cb4-1294" aria-hidden="true" tabindex="-1"></a>      data1 <span class="ot">&lt;-</span> <span class="fu">filtered_data_occ</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-1295"><a href="#cb4-1295" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(</span>
<span id="cb4-1296"><a href="#cb4-1296" aria-hidden="true" tabindex="-1"></a>          <span class="at">Avg_Employees =</span> <span class="fu">sum</span>(annual_average_employees, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-1297"><a href="#cb4-1297" aria-hidden="true" tabindex="-1"></a>          <span class="at">Hours_Worked =</span> <span class="fu">sum</span>(total_hours_worked, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-1298"><a href="#cb4-1298" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-1299"><a href="#cb4-1299" aria-hidden="true" tabindex="-1"></a>      bar_data1 <span class="ot">&lt;-</span> <span class="fu">gather</span>(data1, <span class="at">key =</span> <span class="st">"Metric"</span>, <span class="at">value =</span> <span class="st">"Value"</span>)</span>
<span id="cb4-1300"><a href="#cb4-1300" aria-hidden="true" tabindex="-1"></a>      plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(bar_data1, <span class="fu">aes</span>(<span class="at">x =</span> Metric, <span class="at">y =</span> Value, <span class="at">fill =</span> Metric)) <span class="sc">+</span></span>
<span id="cb4-1301"><a href="#cb4-1301" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb4-1302"><a href="#cb4-1302" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">comma</span>(Value)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb4-1303"><a href="#cb4-1303" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb4-1304"><a href="#cb4-1304" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Employee Details"</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Value"</span>) <span class="sc">+</span></span>
<span id="cb4-1305"><a href="#cb4-1305" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-1306"><a href="#cb4-1306" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(</span>
<span id="cb4-1307"><a href="#cb4-1307" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb4-1308"><a href="#cb4-1308" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-1309"><a href="#cb4-1309" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb4-1310"><a href="#cb4-1310" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb4-1311"><a href="#cb4-1311" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>),</span>
<span id="cb4-1312"><a href="#cb4-1312" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>)</span>
<span id="cb4-1313"><a href="#cb4-1313" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb4-1314"><a href="#cb4-1314" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors)</span>
<span id="cb4-1315"><a href="#cb4-1315" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(plot1)</span>
<span id="cb4-1316"><a href="#cb4-1316" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-1317"><a href="#cb4-1317" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Plot 2: Total Deaths and Total Injuries</span></span>
<span id="cb4-1318"><a href="#cb4-1318" aria-hidden="true" tabindex="-1"></a>      data2 <span class="ot">&lt;-</span> <span class="fu">filtered_data_occ</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-1319"><a href="#cb4-1319" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(</span>
<span id="cb4-1320"><a href="#cb4-1320" aria-hidden="true" tabindex="-1"></a>          <span class="at">Deaths =</span> <span class="fu">sum</span>(total_deaths, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-1321"><a href="#cb4-1321" aria-hidden="true" tabindex="-1"></a>          <span class="at">Injuries =</span> <span class="fu">sum</span>(total_injuries, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-1322"><a href="#cb4-1322" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-1323"><a href="#cb4-1323" aria-hidden="true" tabindex="-1"></a>      bar_data2 <span class="ot">&lt;-</span> <span class="fu">gather</span>(data2, <span class="at">key =</span> <span class="st">"Metric"</span>, <span class="at">value =</span> <span class="st">"Value"</span>)</span>
<span id="cb4-1324"><a href="#cb4-1324" aria-hidden="true" tabindex="-1"></a>      plot2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(bar_data2, <span class="fu">aes</span>(<span class="at">x =</span> Metric, <span class="at">y =</span> Value, <span class="at">fill =</span> Metric)) <span class="sc">+</span></span>
<span id="cb4-1325"><a href="#cb4-1325" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb4-1326"><a href="#cb4-1326" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">comma</span>(Value)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb4-1327"><a href="#cb4-1327" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb4-1328"><a href="#cb4-1328" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Count of Illness"</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Value"</span>) <span class="sc">+</span></span>
<span id="cb4-1329"><a href="#cb4-1329" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-1330"><a href="#cb4-1330" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(</span>
<span id="cb4-1331"><a href="#cb4-1331" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb4-1332"><a href="#cb4-1332" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-1333"><a href="#cb4-1333" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb4-1334"><a href="#cb4-1334" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb4-1335"><a href="#cb4-1335" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>),</span>
<span id="cb4-1336"><a href="#cb4-1336" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>)</span>
<span id="cb4-1337"><a href="#cb4-1337" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb4-1338"><a href="#cb4-1338" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors)</span>
<span id="cb4-1339"><a href="#cb4-1339" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(plot2)</span>
<span id="cb4-1340"><a href="#cb4-1340" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-1341"><a href="#cb4-1341" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Plot 3: DAFW Cases, DJTR Cases, Other Cases</span></span>
<span id="cb4-1342"><a href="#cb4-1342" aria-hidden="true" tabindex="-1"></a>      data3 <span class="ot">&lt;-</span> <span class="fu">filtered_data_occ</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-1343"><a href="#cb4-1343" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(</span>
<span id="cb4-1344"><a href="#cb4-1344" aria-hidden="true" tabindex="-1"></a>          <span class="at">DAFW_Cases =</span> <span class="fu">sum</span>(total_dafw_cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-1345"><a href="#cb4-1345" aria-hidden="true" tabindex="-1"></a>          <span class="at">DJTR_Cases =</span> <span class="fu">sum</span>(total_djtr_cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-1346"><a href="#cb4-1346" aria-hidden="true" tabindex="-1"></a>          <span class="at">Other_Cases =</span> <span class="fu">sum</span>(total_other_cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-1347"><a href="#cb4-1347" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-1348"><a href="#cb4-1348" aria-hidden="true" tabindex="-1"></a>      bar_data3 <span class="ot">&lt;-</span> <span class="fu">gather</span>(data3, <span class="at">key =</span> <span class="st">"Case_Type"</span>, <span class="at">value =</span> <span class="st">"Value"</span>)</span>
<span id="cb4-1349"><a href="#cb4-1349" aria-hidden="true" tabindex="-1"></a>      plot3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(bar_data3, <span class="fu">aes</span>(<span class="at">x =</span> Case_Type, <span class="at">y =</span> Value, <span class="at">fill =</span> Case_Type)) <span class="sc">+</span></span>
<span id="cb4-1350"><a href="#cb4-1350" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb4-1351"><a href="#cb4-1351" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">comma</span>(Value)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb4-1352"><a href="#cb4-1352" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb4-1353"><a href="#cb4-1353" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Different Cases"</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Value"</span>) <span class="sc">+</span></span>
<span id="cb4-1354"><a href="#cb4-1354" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-1355"><a href="#cb4-1355" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(</span>
<span id="cb4-1356"><a href="#cb4-1356" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb4-1357"><a href="#cb4-1357" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-1358"><a href="#cb4-1358" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb4-1359"><a href="#cb4-1359" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb4-1360"><a href="#cb4-1360" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>),</span>
<span id="cb4-1361"><a href="#cb4-1361" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>)</span>
<span id="cb4-1362"><a href="#cb4-1362" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb4-1363"><a href="#cb4-1363" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors)</span>
<span id="cb4-1364"><a href="#cb4-1364" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(plot3)</span>
<span id="cb4-1365"><a href="#cb4-1365" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-1366"><a href="#cb4-1366" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Plot 4: DAFW Days, DJTR Days</span></span>
<span id="cb4-1367"><a href="#cb4-1367" aria-hidden="true" tabindex="-1"></a>      data4 <span class="ot">&lt;-</span> <span class="fu">filtered_data_occ</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-1368"><a href="#cb4-1368" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(</span>
<span id="cb4-1369"><a href="#cb4-1369" aria-hidden="true" tabindex="-1"></a>          <span class="at">DAFW_Days =</span> <span class="fu">sum</span>(total_dafw_days, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-1370"><a href="#cb4-1370" aria-hidden="true" tabindex="-1"></a>          <span class="at">DJTR_Days =</span> <span class="fu">sum</span>(total_djtr_days, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-1371"><a href="#cb4-1371" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-1372"><a href="#cb4-1372" aria-hidden="true" tabindex="-1"></a>      bar_data4 <span class="ot">&lt;-</span> <span class="fu">gather</span>(data4, <span class="at">key =</span> <span class="st">"Days_Type"</span>, <span class="at">value =</span> <span class="st">"Value"</span>)</span>
<span id="cb4-1373"><a href="#cb4-1373" aria-hidden="true" tabindex="-1"></a>      plot4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(bar_data4, <span class="fu">aes</span>(<span class="at">x =</span> Days_Type, <span class="at">y =</span> Value, <span class="at">fill =</span> Days_Type)) <span class="sc">+</span></span>
<span id="cb4-1374"><a href="#cb4-1374" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb4-1375"><a href="#cb4-1375" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">comma</span>(Value)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb4-1376"><a href="#cb4-1376" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb4-1377"><a href="#cb4-1377" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Time Duration"</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Days"</span>) <span class="sc">+</span></span>
<span id="cb4-1378"><a href="#cb4-1378" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-1379"><a href="#cb4-1379" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(</span>
<span id="cb4-1380"><a href="#cb4-1380" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb4-1381"><a href="#cb4-1381" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-1382"><a href="#cb4-1382" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb4-1383"><a href="#cb4-1383" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb4-1384"><a href="#cb4-1384" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>),</span>
<span id="cb4-1385"><a href="#cb4-1385" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>)</span>
<span id="cb4-1386"><a href="#cb4-1386" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb4-1387"><a href="#cb4-1387" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors)</span>
<span id="cb4-1388"><a href="#cb4-1388" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(plot4)</span>
<span id="cb4-1389"><a href="#cb4-1389" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-1390"><a href="#cb4-1390" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Plot 5: Illness Categories</span></span>
<span id="cb4-1391"><a href="#cb4-1391" aria-hidden="true" tabindex="-1"></a>      data5 <span class="ot">&lt;-</span> <span class="fu">filtered_data_occ</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-1392"><a href="#cb4-1392" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(</span>
<span id="cb4-1393"><a href="#cb4-1393" aria-hidden="true" tabindex="-1"></a>          <span class="at">Poisonings =</span> <span class="fu">sum</span>(total_poisonings, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-1394"><a href="#cb4-1394" aria-hidden="true" tabindex="-1"></a>          <span class="at">Respiratory =</span> <span class="fu">sum</span>(total_respiratory_conditions, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-1395"><a href="#cb4-1395" aria-hidden="true" tabindex="-1"></a>          <span class="at">Skin_Disorders =</span> <span class="fu">sum</span>(total_skin_disorders, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-1396"><a href="#cb4-1396" aria-hidden="true" tabindex="-1"></a>          <span class="at">Hearing_Loss =</span> <span class="fu">sum</span>(total_hearing_loss, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-1397"><a href="#cb4-1397" aria-hidden="true" tabindex="-1"></a>          <span class="at">Other =</span> <span class="fu">sum</span>(total_other_illnesses, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-1398"><a href="#cb4-1398" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-1399"><a href="#cb4-1399" aria-hidden="true" tabindex="-1"></a>      bar_data5 <span class="ot">&lt;-</span> <span class="fu">gather</span>(data5, <span class="at">key =</span> <span class="st">"Illness_Type"</span>, <span class="at">value =</span> <span class="st">"Value"</span>)</span>
<span id="cb4-1400"><a href="#cb4-1400" aria-hidden="true" tabindex="-1"></a>      plot5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(bar_data5, <span class="fu">aes</span>(<span class="at">x =</span> Illness_Type, <span class="at">y =</span> Value, <span class="at">fill =</span> Illness_Type)) <span class="sc">+</span></span>
<span id="cb4-1401"><a href="#cb4-1401" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb4-1402"><a href="#cb4-1402" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">comma</span>(Value)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb4-1403"><a href="#cb4-1403" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb4-1404"><a href="#cb4-1404" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Illness Categories vs Illness"</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Total Illness"</span>) <span class="sc">+</span></span>
<span id="cb4-1405"><a href="#cb4-1405" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-1406"><a href="#cb4-1406" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(</span>
<span id="cb4-1407"><a href="#cb4-1407" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb4-1408"><a href="#cb4-1408" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-1409"><a href="#cb4-1409" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb4-1410"><a href="#cb4-1410" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb4-1411"><a href="#cb4-1411" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>),</span>
<span id="cb4-1412"><a href="#cb4-1412" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>)</span>
<span id="cb4-1413"><a href="#cb4-1413" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb4-1414"><a href="#cb4-1414" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors)</span>
<span id="cb4-1415"><a href="#cb4-1415" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(plot5)</span>
<span id="cb4-1416"><a href="#cb4-1416" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-1417"><a href="#cb4-1417" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Close the PDF device to finish saving the plots</span></span>
<span id="cb4-1418"><a href="#cb4-1418" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dev.off</span>()</span>
<span id="cb4-1419"><a href="#cb4-1419" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-1420"><a href="#cb4-1420" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-1421"><a href="#cb4-1421" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-1422"><a href="#cb4-1422" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Interactive Filters for Occupational Illness</span></span>
<span id="cb4-1423"><a href="#cb4-1423" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-1424"><a href="#cb4-1424" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reactive expression to filter the dataset based on user inputs</span></span>
<span id="cb4-1425"><a href="#cb4-1425" aria-hidden="true" tabindex="-1"></a>  filtered_data_table_occ <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb4-1426"><a href="#cb4-1426" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Start with the full dataset of occupational injuries</span></span>
<span id="cb4-1427"><a href="#cb4-1427" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> occ_injuries_data</span>
<span id="cb4-1428"><a href="#cb4-1428" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1429"><a href="#cb4-1429" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data by the selected year</span></span>
<span id="cb4-1430"><a href="#cb4-1430" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> input<span class="sc">$</span>year_filter_occ)</span>
<span id="cb4-1431"><a href="#cb4-1431" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1432"><a href="#cb4-1432" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the data by industry if selected</span></span>
<span id="cb4-1433"><a href="#cb4-1433" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>industry_filter_occ <span class="sc">!=</span> <span class="st">"All Industries"</span>) {</span>
<span id="cb4-1434"><a href="#cb4-1434" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(industry <span class="sc">==</span> input<span class="sc">$</span>industry_filter_occ)</span>
<span id="cb4-1435"><a href="#cb4-1435" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-1436"><a href="#cb4-1436" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1437"><a href="#cb4-1437" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the data by state if selected</span></span>
<span id="cb4-1438"><a href="#cb4-1438" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>state_filter_occ <span class="sc">!=</span> <span class="st">"All States"</span>) {</span>
<span id="cb4-1439"><a href="#cb4-1439" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(state <span class="sc">==</span> input<span class="sc">$</span>state_filter_occ)</span>
<span id="cb4-1440"><a href="#cb4-1440" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-1441"><a href="#cb4-1441" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1442"><a href="#cb4-1442" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data based on whether the injury/illness type is selected as 'Yes' (1) or 'No' (2)</span></span>
<span id="cb4-1443"><a href="#cb4-1443" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>illness_injuries_filter_occ <span class="sc">==</span> <span class="st">"Yes"</span>) {</span>
<span id="cb4-1444"><a href="#cb4-1444" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(injury_illness <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb4-1445"><a href="#cb4-1445" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb4-1446"><a href="#cb4-1446" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(injury_illness <span class="sc">==</span> <span class="dv">2</span>)</span>
<span id="cb4-1447"><a href="#cb4-1447" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-1448"><a href="#cb4-1448" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1449"><a href="#cb4-1449" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data based on respiratory conditions</span></span>
<span id="cb4-1450"><a href="#cb4-1450" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>respiratory_conditions_filter_occ <span class="sc">==</span> <span class="st">"No"</span>) {</span>
<span id="cb4-1451"><a href="#cb4-1451" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(total_respiratory_conditions <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb4-1452"><a href="#cb4-1452" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb4-1453"><a href="#cb4-1453" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(total_respiratory_conditions <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb4-1454"><a href="#cb4-1454" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-1455"><a href="#cb4-1455" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1456"><a href="#cb4-1456" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data based on skin disorders</span></span>
<span id="cb4-1457"><a href="#cb4-1457" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>skin_disorder_filter_occ <span class="sc">==</span> <span class="st">"Yes"</span>) {</span>
<span id="cb4-1458"><a href="#cb4-1458" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(total_skin_disorders <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb4-1459"><a href="#cb4-1459" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb4-1460"><a href="#cb4-1460" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(total_skin_disorders <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb4-1461"><a href="#cb4-1461" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-1462"><a href="#cb4-1462" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1463"><a href="#cb4-1463" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data based on hearing loss</span></span>
<span id="cb4-1464"><a href="#cb4-1464" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>hearing_loss_filter_occ <span class="sc">==</span> <span class="st">"Yes"</span>) {</span>
<span id="cb4-1465"><a href="#cb4-1465" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(total_hearing_loss <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb4-1466"><a href="#cb4-1466" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb4-1467"><a href="#cb4-1467" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(total_hearing_loss <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb4-1468"><a href="#cb4-1468" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-1469"><a href="#cb4-1469" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1470"><a href="#cb4-1470" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data based on other illnesses</span></span>
<span id="cb4-1471"><a href="#cb4-1471" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>other_illness_filter_occ <span class="sc">==</span> <span class="st">"Yes"</span>) {</span>
<span id="cb4-1472"><a href="#cb4-1472" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(total_other_illnesses <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb4-1473"><a href="#cb4-1473" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb4-1474"><a href="#cb4-1474" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(total_other_illnesses <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb4-1475"><a href="#cb4-1475" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-1476"><a href="#cb4-1476" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1477"><a href="#cb4-1477" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Format the state column to have only the first letter in uppercase</span></span>
<span id="cb4-1478"><a href="#cb4-1478" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> </span>
<span id="cb4-1479"><a href="#cb4-1479" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">state =</span> stringr<span class="sc">::</span><span class="fu">str_to_title</span>(state))</span>
<span id="cb4-1480"><a href="#cb4-1480" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-1481"><a href="#cb4-1481" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the filtered dataset</span></span>
<span id="cb4-1482"><a href="#cb4-1482" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(data)</span>
<span id="cb4-1483"><a href="#cb4-1483" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-1484"><a href="#cb4-1484" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-1485"><a href="#cb4-1485" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Render the filtered data table based on the user-selected filters</span></span>
<span id="cb4-1486"><a href="#cb4-1486" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>filtered_table_occ <span class="ot">&lt;-</span> <span class="fu">renderDT</span>({</span>
<span id="cb4-1487"><a href="#cb4-1487" aria-hidden="true" tabindex="-1"></a>    <span class="fu">datatable</span>(</span>
<span id="cb4-1488"><a href="#cb4-1488" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Render the datatable with filtered data</span></span>
<span id="cb4-1489"><a href="#cb4-1489" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filtered_data_table_occ</span>(),</span>
<span id="cb4-1490"><a href="#cb4-1490" aria-hidden="true" tabindex="-1"></a>      <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-1491"><a href="#cb4-1491" aria-hidden="true" tabindex="-1"></a>      <span class="at">rownames =</span> <span class="cn">FALSE</span></span>
<span id="cb4-1492"><a href="#cb4-1492" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-1493"><a href="#cb4-1493" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-1494"><a href="#cb4-1494" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-1495"><a href="#cb4-1495" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Download handler to export the filtered data as a CSV file</span></span>
<span id="cb4-1496"><a href="#cb4-1496" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>download_occ_data <span class="ot">&lt;-</span> <span class="fu">downloadHandler</span>(</span>
<span id="cb4-1497"><a href="#cb4-1497" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="cf">function</span>() {</span>
<span id="cb4-1498"><a href="#cb4-1498" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(<span class="st">"filtered_data_"</span>, <span class="fu">Sys.time</span>(), <span class="st">".csv"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb4-1499"><a href="#cb4-1499" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb4-1500"><a href="#cb4-1500" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Write the filtered data to the CSV file</span></span>
<span id="cb4-1501"><a href="#cb4-1501" aria-hidden="true" tabindex="-1"></a>    <span class="at">content =</span> <span class="cf">function</span>(file) {</span>
<span id="cb4-1502"><a href="#cb4-1502" aria-hidden="true" tabindex="-1"></a>      <span class="fu">write.csv</span>(<span class="fu">filtered_data_table_occ</span>(), file, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-1503"><a href="#cb4-1503" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-1504"><a href="#cb4-1504" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-1505"><a href="#cb4-1505" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-1506"><a href="#cb4-1506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1507"><a href="#cb4-1507" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the Shiny app</span></span>
<span id="cb4-1508"><a href="#cb4-1508" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>